<TMPL_IF NAME='LOGIN'>
	<TMPL_INCLUDE NAME="widgets/Login.tmpl">
</TMPL_IF>

<TMPL_IF NAME='MAIN'>
<style type="text/css">
@font-face {
    font-family: 'Glyphicons Halflings';
    src: url('./js/vendor/bootstrap/fonts/glyphicons-halflings-regular.eot');
	src: url('./js/vendor/bootstrap/fonts/glyphicons-halflings-regular.eot?#iefix') format('embedded-opentype'), url('./js/vendor/bootstrap/fonts/glyphicons-halflings-regular.woff') format('woff'), url('./js/vendor/bootstrap/fonts/glyphicons-halflings-regular.ttf') format('truetype'), url('./js/vendor/bootstrap/fonts/glyphicons-halflings-regular.svg#glyphicons_halflingsregular') format('svg');
}

.glyphicon {
    position: relative;
    top: 1px;
    display: inline-block;
    font-family: 'Glyphicons Halflings';
    font-style: normal;
    font-weight: normal;
    line-height: 1;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
}

.glyphicon-asterisk:before {
    content: "\2a";
}

.jstree li a ins { display:none !important; }
.jstree.jstree-focused { background:white; }
</style>

<div id="wizard-container"></div>

<!-- DIALOGS -->
<div id="splash_dialog" class="dialog_box" title="Load Experiment" style="display:none;">
	<div>
		<br>
		Welcome to Load Genome!
		<br><br>
		This page allows you to load genome sequences in FASTA file format.
		<br><br>
		See <a href="<TMPL_VAR NAME=HELP_URL>">this article</a> for detailed instructions.
		Or at any time you can click the <a href="<TMPL_VAR NAME=HELP_URL>">"Need help?"</a> link in the upper right of this page.
	</div>
    <br><br>
    <span id="splash_ok_button" onClick="if($('#load_genome_splash_dont_show_again').prop('checked'))$.cookie('load_genome_splash_dont_show_again','true',{expires:10000});$('#splash_dialog').dialog('close');" class="r ui-button ui-corner-all">OK</span>
    <input id="load_genome_splash_dont_show_again" type="checkbox" /> <span class="small">Don't show this message again</span>
</div>
    
<!-- Step Templates -->
<script id="description-template" type="text/template">
    <div class="step">
    
	    <div class="form-field">
		    <label class="col-md-2">Organism:</label>
		    <input class="col-md-8" id="edit_organism" type="search" placeholder="Search"
		    	title="Enter the organism associated with the new genome. Start typing to narrow down the list of organisms to choose from." spellcheck="false"
		    	onclick="$(this).autocomplete('search');"
		    	onkeyup="wait_to_search(search_organisms, this);" size="50" value="<TMPL_VAR NAME='ORGANISM_NAME'>" />
		    <span style="color: red; font-size: 0.75em" class="col-md-2 glyphicon glyphicon-asterisk"></span>
		</div>

        <div class="form-field">
            <label class="col-md-2">Version:</label>
            <input id="edit_version" type="textbox" class="col-md-8" size="10" title="Enter whatever version info you would like for the new experiment. Note: the system will automatically prepend a 'v' to whatever you enter." value="<TMPL_VAR NAME='NAME'>" spellcheck="false" />
            <span style="color: red; font-size: 0.75em" class="col-md-2 glyphicon glyphicon-asterisk"></span>
        </div>
        
        <div class="form-field">
	        <label class="col-md-2">Type:</label>
	
	        <div>
	        	<select id="select_type" class="col-md-6"></select>
	            <div class="col-md-2">
	                <span id="new_type_button" title="Add a new sequence type" onClick="$('#create_new_type_dialog').dialog('open'); activate_on_input('edit_type_name', 'create_type_button');" class='ui-button ui-corner-all coge-button'>New</span>
	            </div>
	        </div>
	
	        <span style="color: red; font-size: 0.75em" class="col-md-2 glyphicon glyphicon-asterisk"></span>
        </div>

        <div class="form-field">
            <label class="col-md-2">Source:</label>

            <div>
                <input id="edit_source" type="search" class="col-md-6" placeholder="Search" title="Enter the source for the data for the new experiment. Start typing to select an exisisting source or click 'New' to add a source." size="50" spellcheck="false" onclick='$(this).autocomplete("search");' />
                <div class="col-md-2">
                    <span id="new_source_button" title="Add a new source" onClick="$('#create_new_source_dialog').dialog('open'); activate_on_input('edit_source_name', 'create_source_button');" class='ui-button ui-corner-all'>New</span>
                </div>
            </div>

            <span style="color: red; font-size: 0.75em" class="col-md-2 glyphicon glyphicon-asterisk"></span>
        </div>

        <div class="form-field">
            <label class="col-md-2">Restricted?</label>
            <input id="restricted" type="checkbox" title="Leave unchecked to make the new experiment public, or check the box to make the new experiment private to the current user. Note: restricted experiments can be shared with other users on the Profile page." checked>
        </div>

        <div>
        	<div class="link" style="padding-left:1em;" onclick="$(this).hide().siblings().toggle();">more ...</div>
        
	        <div class="form-field hidden">
		        <label class="col-md-2">Name:</label>
		        <input id="edit_name" type="textbox" class="col-md-8" title="Enter a unique name for the new experiment" value="<TMPL_VAR NAME='NAME'>" spellcheck="false" />
		    </div>
		
		    <div class="form-field hidden">
		        <label class="col-md-2">Description:</label>
		        <textarea id="edit_description" class="col-md-8 no-resize" title="Enter a description for the new experiment" rows="5" cols="50" ><TMPL_VAR NAME='DESC'></textarea>
		    </div>
		    
		    <div class="form-field hidden">
		        <label class="col-md-2">Link:</label>
		        <input id="edit_link" type="textbox" class="col-md-8" title="Enter a hyperlink for the source data or genome project" spellcheck="false" />
		    </div>
	    </div>

    </div>
</script>

<script id="data-template" type="text/template">
    <div class="step">
        <div id="selector_container"></div><br>
        <div id="files" class="hidden coge-padded">
            Selected file(s):<br>
            <table id="file_table" class="small" style="background-color:white;display:inline;"></table>
            <span id="select_file_type" class="hidden" style="padding-left:15px;vertical-align:5px;">
                File type:
                <select id="file_type_selector">
                    <option value="fasta">FASTA, FA, FAA</option>
                </select>
            </span>
        </div>
    </div>
</script>

<script id="confirm-template" type="text/template">
	<div class="step info">
	    <h3>Description</h3>
	    <div class="confirm-description padded"></div>
	    <h3>Data</h3>
	    <div class="confirm-data padded"></div>
	</div>
</script>

<script id="progress-buttons-custom" type="text/template">
	<span onClick="handle_action();" class="ui-button ui-corner-all coge-button r">GO</span>
	<span class="r" style="padding-top:5px;">
	    <select>
	        <option value="genome">View Genome Info</option>
	        <option value="annotation">Load Annotations</option>
	        <option value="new">Load Another Genome</option>
	    </select>
	</span>
	<span class="r" style="padding-right:0.5em; padding-top:6px;">Next Step:</span>
</script>

<!--
<div class="bold text" style="padding-top:1em;">1 - Describe the Genome</div>
<div class="coge-bg inline padded ui-widget-content ui-corner-all">
	<div class="small info">
		Complete the form below to describe the genome sequence.
		<div class="alert"><span class="small glyphicon glyphicon-asterisk"></span> denotes a required field</div>
	</div>  
	
	<table class="small" style="padding-top:0.5em;">
	  <tr>
	    <td>Organism:</td>
	    <td>
	      <TMPL_IF NAME=ORGANISM_NAME>
	        <input id="edit_organism" type="search" placeholder="Search" onkeyup="wait_to_search(search_organisms, this.value);" value="<TMPL_VAR NAME=ORGANISM_NAME>"size="50" spellcheck="false" />
	      <TMPL_ELSE>
	        <input id="edit_organism" type="search" placeholder="Search" onkeyup="wait_to_search(search_organisms, this.value);" size="50" spellcheck="false" />
	      </TMPL_IF>
	      <span id="new_organism_button" onClick="$('#create_new_organism_dialog').dialog('open'); activate_on_input('edit_organism_name', 'create_organism_button');" class='ui-button ui-corner-all coge-button'>New</span>
	    </td>
	    <td><span style="color: red; font-size: 0.75em" class="glyphicon glyphicon-asterisk"></span></td>
	  </tr>
	  <tr>
	    <td>Version:</td>
	    <td><input id="edit_version" type="textbox" size="10" spellcheck="false" /><span style="color: red; font-size: 0.75em" class="glyphicon glyphicon-asterisk"></span></td>
	  </tr>
	  <tr>
	    <td>Type:</td>
	    <td>
	      <select id="select_type" style="width:230px;"></select>
	      <span id="new_type_button" onClick="$('#create_new_type_dialog').dialog('open'); activate_on_input('edit_type_name', 'create_type_button');" class='ui-button ui-corner-all coge-button'>New</span>
	    </td>
	  </tr>
	  <tr>
	    <td>Source:</td>
	    <td>
	      <input id="edit_source" type="search" placeholder="Search" size="50" spellcheck="false" />
	      <span id="new_source_button" onClick="$('#create_new_source_dialog').dialog('open'); activate_on_input('edit_source_name', 'create_source_button');" class='ui-button ui-corner-all coge-button'>New</span>
	    </td>
	    <td><span style="color: red; font-size: 0.75em" class="glyphicon glyphicon-asterisk"></span></td>
	  </tr>
	  <tr>
	    <td>Restricted?</td>
	    <td><input id="restricted" type="checkbox" checked></td>
	  </tr>
	  <tr id='more'>
	    <td colspan="2"><span class="link" onclick="more();">more...</span></td>
	  </tr>
	  <tr class="hidden">
	    <td>Name:</td>
	    <td><input id="edit_name" type="textbox" placeholder="Optional" size="58" spellcheck="false" /></td>
	  </tr>
	  <tr class="hidden">
	    <td>Description:</td>
	    <td><textarea id="edit_description" placeholder="Optional" rows="5" cols="50" ></textarea></td>
	  </tr>
	  <tr class="hidden">
	    <td>Link:</td>
	    <td><input id="edit_link" type="textbox" placeholder="Optional" size="58" /></td>
	  </tr>
	</table>
</div>
-->

<div id="create_new_type_dialog" class="hidden dialog_box" title="Create New Sequence Type">
  <table class="small">
    <tr>
      <td>Name:</td>
      <td><input id="edit_type_name" type="textbox" size="53" onkeyup="activate_on_input('edit_type_name', 'create_type_button');" /></td>
    </tr>
    <tr>
      <td>Description:</td>
      <td><textarea id="edit_type_desc" rows="5" cols="50" ></textarea></td>
    </tr>
  </table>
  <br>
  <span id="create_type_button" onClick="create_sequence_type();" class="ui-state-disabled ui-button ui-corner-all coge-button r">Create new type</span>
</div>

<div id="create_new_organism_dialog" class="hidden dialog_box" title="Create New Organism">
	<div class ="small info" style="padding-top:10px;">
		Please select an organism from NCBI's Taxonomy database.  If your organism does not exist,
		find the nearest relative and modify the name and description fields accordingly.
	</div>
	<div style="padding-top:10px;">
    	<span class="small">Search NCBI:</span>
    	<input type="textbox" size="45" spellcheck="false" onkeyup="wait_to_search(search_ncbi_taxonomy, this);" />
	    <img id="wait_ncbi" src="picts/ajax-loader.gif" style="opacity: 0;" />
	</div>
	<div id="tax_empty" class="hidden small" style="font-style:italic;color:gray;margin-top:15px;margin-left:20px;">No matches</div>
	<div id="tax_tree" class="hidden small" style="border:1px solid lightgray;margin-top:5px;max-height:200px;max-width:415px;overflow-y:auto">
	</div>
	<div id="edit_organism_info" class="hidden" style="padding-top:15px;">
		<span class="small">You have selected:</span><br>
		<table style="color:gray;">
			<tr>
				<td class="small" style="font-weight:bold;">Name</td>
				<td>
					<input id="edit_organism_name" type="textbox" size="54" spellcheck="false" style="color:gray;background-color:white;" onkeyup="activate_on_input(['edit_organism_name', 'edit_organism_desc'], 'create_organism_button');" />
				</td>
			</tr>
			<tr>
				<td class="small" style="font-weight:bold;">Description</td>
				<td>
					<textarea id="edit_organism_desc" rows="5" cols="57" spellcheck="false" style="color:gray;resize:none;border:1px solid lightgray;" onkeyup="activate_on_input(['edit_organism_name', 'edit_organism_desc'], 'create_organism_button');"></textarea>
				</td>
			</tr>
		</table>
	</div>
  <br>
  <span id="create_organism_button" onClick="create_organism();" class="ui-state-disabled ui-button ui-corner-all coge-button r">Create</span>
</div>

<div id="create_new_source_dialog" class="hidden dialog_box" title="Create New Source">
  <table class="small">
    <tr>
      <td>Name:</td>
      <td><input id="edit_source_name" type="textbox" size="53" onkeyup="activate_on_input('edit_source_name', 'create_source_button');" /></td>
    </tr>
    <tr>
      <td>Description:</td>
      <td><textarea id="edit_source_desc" rows="5" cols="50" ></textarea></td>
    </tr>
    <tr>
      <td>Link:</td>
      <td><input id="edit_source_link" type="textbox" size="53" /></td>
    </tr>
  </table>
  <br>
  <span id="create_source_button" onClick="create_source();" class="ui-state-disabled ui-button ui-corner-all coge-button r">Create</span>
</div>

<!--
<div id="load_dialog" class="hidden dialog_box" title="Loading Genome ...">
  <div id="load_log" class="small padded ui-widget-content ui-corner-all" style="overflow-y:auto;width:450px;height:200px;color:dimgray;">
  </div>
  <br>
  <div id="loading_msg">
    <span class="small" style="float:right;">Link: <a></a></span>
    Please wait ... <img src="picts/ajax-loader.gif"/>
  </div>
  <div class="coge-buttonset">
	  <span id="finished_msg" class="hidden">Finished! <img src="picts/thumbs_up.png"></span>
	  <span id="error_msg" class="hidden">An error occurred <img style="vertical-align:text-top" src="picts/thumbs_down.png"></span>
      <span id="finish_actions" class="hidden">
	    <span onClick="handle_action();" class="ui-button ui-corner-all coge-button r">GO</span>
	    <span class="r" style="padding-top:5px;">
	        <select>
	            <option value="genome">View Genome Info</option>
	            <option value="annotation">Load Annotations</option>
	            <option value="new">Load Another Genome</option>
	        </select>
        </span>
        <span class="r" style="padding-right:0.5em; padding-top:6px;">Next Step:</span>
      </span>
	  <span id="cancel_button" onClick="reset_load();" style="float:right;" class="hidden ui-button ui-corner-all ui-button-go coge-button">Cancel</span>
      <span id="logfile" class="hidden"><a href="">Logfile</a></span>
  </div>
</div>
-->

<TMPL_INCLUDE NAME="widgets/FileSelect.tmpl">

<TMPL_INCLUDE NAME="widgets/Progress.tmpl">

<TMPL_INCLUDE NAME="widgets/Wizard.tmpl">

<TMPL_IF NAME='ADMIN_AREA'>
<script>
$(document).ready(function() {
	$("#edit_user").autocomplete({
		source:[],
		focus: function() { return false; },
	});
});
</script>
<br><br><hr>
<span style="color:dimgray;font-weight:bold;">Admin Functions</span><br>
<table class="small ui-widget-content ui-corner-all">
  <tr>
    <td>Assign to user</td>
    <td>
      <input id="edit_user" type="search" placeholder="search" onkeyup="wait_to_search(search_users, this);" size="10" />
    </td>
  </tr>
  <tr>
  	<td>Keep section headers</td>
  	<td>
  		<input id="keep_headers" type="checkbox" />
  	</td>
  </tr>
</table>
<br>
</TMPL_IF> <!-- ADMIN_AREA -->

<script type="text/javascript">
// Page constants
const API_BASE_URL  = '<TMPL_VAR NAME="API_BASE_URL">';
const PAGE_NAME     = '<TMPL_VAR NAME="PAGE_NAME">';
const SUPPORT_EMAIL = '<TMPL_VAR NAME="SUPPORT_EMAIL">';
const HELP_URL      = '<TMPL_VAR NAME="HELP_URL">';
const USER_NAME     = '<TMPL_VAR NAME="USER">'
const IS_ADMIN      = Boolean('<TMPL_VAR NAME="ADMIN_AREA">');
const ENTREZ_URL    = '//eutils.ncbi.nlm.nih.gov/entrez/eutils/';

var LOAD_ID = load_id = '<TMPL_VAR NAME="LOAD_ID">';
var WORKFLOW_ID 	  = '<TMPL_VAR NAME="WORKFLOW_ID">';
var EMBED 			  = '<TMPL_VAR NAME="EMBED">';

// File Select constants
const DEFAULT_TAB              = '<TMPL_VAR NAME="DEFAULT_TAB">';
const MAX_IRODS_LIST_FILES     = '<TMPL_VAR NAME="MAX_IRODS_LIST_FILES">';
const MAX_IRODS_TRANSFER_FILES = '<TMPL_VAR NAME="MAX_IRODS_TRANSFER_FILES">';
const MAX_FTP_FILES            = '<TMPL_VAR NAME="MAX_FTP_FILES">';
const FILE_SELECT_SINGLE       = '<TMPL_VAR NAME="FILE_SELECT_SINGLE">';

var timestamps = new Array();
var genome_id;
var pageObj = {}; //FIXME get rid of this
var newLoad = false;

$(function() {
	// Configure jQuery ajax
	$.ajaxSetup({
		type: "GET",
		url: PAGE_NAME,
		dataType: "html",
		cache: false
	});

	// Configure dialogs
    $(".dialog_box").dialog({autoOpen: false, width: '35em'});
    $('#load_dialog').dialog("widget").find('.ui-dialog-titlebar-close').hide();
    $('#load_dialog').dialog({modal: true, closeOnEscape: false});
    
    // Initialize wizard
    wizard = initialize_wizard({ 
    	admin: IS_ADMIN,
    	helpUrl: HELP_URL,
    	//gid: GENOME_ID
    });
    
    // Initialize CoGe web services
    coge.services.init({
    	baseUrl: API_BASE_URL,
    	userName: USER_NAME
    });
    
    // Initialize progress dialog
    coge.progress.init({
    	title: "Loading Genome",
    	baseUrl: API_BASE_URL,
    	userName: USER_NAME,
    	supportEmail: SUPPORT_EMAIL,
    	onReset: reset_load,
    	buttonTemplate: 'progress-buttons-custom' // replaces default buttons
    });

	// Open status dialog
    if (WORKFLOW_ID) {
    	coge.progress.begin();
    	coge.progress.update(WORKFLOW_ID);
    }

    // Show splash popup
	if (!$.cookie('load_genome_splash_dont_show_again') && !WORKFLOW_ID) {
		$('#splash_dialog').dialog({modal:true}).dialog('open');
	}
});
</script>
<script type="text/javascript" src="js/pages/load-genome.js"></script>
<script type="text/javascript" src="js/coge/utils.js"></script>
<script type="text/javascript" src="js/coge/services.js"></script>
<script type="text/javascript" src="js/coge/progress.js"></script>
<script type="text/javascript" src="js/coge/wizard.js"></script>
<script type="text/javascript" src="js/coge/file-select.js"></script>
<script type="text/javascript" src="js/jquery.fileupload.js"></script>
<script type="text/javascript" src="js/jstree/jquery.jstree.js"></script>
</TMPL_IF> <!-- MAIN -->
