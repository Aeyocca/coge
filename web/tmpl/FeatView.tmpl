<HTML>
<HEAD>
 <TITLE><TMPL_VAR NAME=TITLE></TITLE>
 <link rel="stylesheet" type="text/css" href="/CoGe/css/styled.css" />
 <link rel="stylesheet" type="text/css" href="/CoGe/css/sddm.css" />

 <link rel="stylesheet" type="text/css" href="css/tiler.css">

 <meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1" />
</HEAD>

<SCRIPT language="JavaScript" type="text/javascript" src="./js/kaj.stable.js"></SCRIPT>
<SCRIPT language="JavaScript">

<!--kaj.pollute();-->

function search_chain(val) {
 minlen = 4;
 if ((val == 1) && (kaj.GS('accn').length > minlen)){
   return;
 } 
 kaj.GS('DS_title','');
 kaj.GS('FT_title','');
 kaj.GS('accn_list','');	
 kaj.GS('Source','');	
 kaj.GS('FeatType','');	
 kaj.GS('anno','');	
 if (val == 1 || kaj.GS('accn').length > minlen) {
   kaj.GS('DS_title','<font class="loading">Searching. . .</font>');// for "'+kaj.GS('accn')+'" type '+''+'. . .</font>');
   cogesearch(['accn', 'type', 'org'],[source_search_chain]); 
 }
}

function source_search_chain (val) {
 kaj.GS('DS_title','');
 kaj.GS('FT_title','');
 kaj.GS('Source','<font class="loading">Loading. . .</font>');	
 kaj.GS('FeatType','');	
 kaj.GS('anno','');	
 if (val) {kaj.GS('accn_list',val);}
 source_search(['accn_select'], [get_types_chain]);
}

function get_types_chain (val1, val2) {
 kaj.GS('FT_title','');
 kaj.GS('FeatType','<font class="loading">Loading. . .</font>');	
 kaj.GS('anno','');	
 if (val1) {kaj.GS('Source', val1);}
 if (val2) {kaj.GS('DS_title', "Dataset");}
 get_types(['accn_select', 'dsid'],[get_anno_chain]);	
}

function get_anno_chain (val1, val2) {
 kaj.GS('anno','<font class="loading">Loading. . .</font>');	
 if (val1) {kaj.GS('FeatType', val1)};
 if (val2) {kaj.GS('FT_title', "Type Name");}
 as = kaj.G('accn_select');
// v = kaj.G('version');
 tn = kaj.G('Type_name');
 get_anno(['accn_select', 'Type_name', 'dsid'],['anno']);	
}

function tiler_setup (html, id)
 {
   kaj.GS(id,html);
   omap = new Tiler('container',[config]);
   var qurl = 'http://toxic.berkeley.edu/CoGe/FeatAnno.pl?';
   addEvent(G('container'),'click',query);	
}

function query(e){
   var xy = e.getItemXY(); 
   xy = this.pix_to_real_world(xy[0],xy[1])[0];
   var url = qurl + 'chr='+ G('chr').value + '&di='+G('di').value + '&loc='+ xy;
   jfetch(url,placeanno);
}

function placeanno(stuff) {
 //  document.info.info.value = stuff; 
  kaj.GS('info', stuff);
}


</SCRIPT>
<TABLE>
 <TR>
  <TD valign=top>
   <DIV class="">
     <TABLE>
       <TR>
         <TD nowrap>
           Feature Name:
         <tD>
          <input type="text" name="accn" id="accn" tabindex="1"  size="10" onKeyup ="search_chain(0);"  onBlur="search_chain(1);" value="<TMPL_VAR NAME=ACCN>"/>
        <TR>
	 <tD nowrap>
          Feature Type:
         <TD>
          <select  name="type" id="type" onKeyup ="search_chain(0);"  onChange="search_chain(1);" />
          <TMPL_LOOP NAME="TYPE_LOOP">
          <TMPL_VAR NAME=TYPE> 
          </TMPL_LOOP>
         </SELECT>
        <TR>
	 <tD nowrap>
          Organism:
         <TD>
          <select  name="org" id="org" onKeyup ="search_chain(0);"  onChange="search_chain(1);" />
          <TMPL_LOOP NAME="ORG_LOOP">
          <TMPL_VAR NAME=ORG> 
          </TMPL_LOOP>
         </SELECT>
     </TABLE>
   </DIV>
  </TD>
  <TD valign=top>
   <DIV id="DS_title"></DIV>
  <TD valign=top>
   <DIV id="FT_title"></DIV>
 <TR valign=top>
  <TD valign=top>
   <DIV class="" id="accn_list"><input type="hidden" id="accn_select" ></DIV>
  </TD>
  <TD valign=top>
   <DIV class="" id="Source"></DIV>
  <TD valign=top>
    <DIV class="" id="FeatType"></DIV>
 </TR>
</TABLE>
<DIV id="anno"></DIV>
<SCRIPT language="Javascript">
  if (kaj.GS('accn')) {search_chain(0);};
</SCRIPT>

