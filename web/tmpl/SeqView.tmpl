
<TMPL_IF NAME="JS">
<SCRIPT language="JavaScript">

$(document).ready(function(){
//$('#hide_annotation_button').hide();
//$('#dna_button').hide(0);
$('#maketable').html('<div id ="annotation" style = "overflow: auto; height: 300px; width: auto;"></DIV>');
//$('#feat_annos').toggle(0);
  var featid = <TMPL_VAR NAME=FEATID>;
  if (featid){
    myObj = new generate_seq_obj_with_featid(featid,'<TMPL_VAR NAME=FEATNAME>');}
  else{
    myObj = new generate_seq_obj(<TMPL_VAR NAME=DSID>,'<TMPL_VAR NAME=CHR>');}
  get_sequence(<TMPL_VAR NAME=RC>);
});


function generate_seq_obj(dsid,chr){
  this.dsid=dsid;
  this.start=$('#upstream').val();
  this.stop=$('#downstream').val();
  this.chr=chr;
}

function generate_seq_obj_with_featid(featid,featname){
  this.featid=featid;
  this.start=$('#upstream').val();
  this.stop=$('#downstream').val();
  this.featname=featname
}

function reset_updown() {
  $('#upstream').val(0);
  $('#downstream').val(0);
}

function dynamic_buttons(button){
 //alert(button);
 $('.seqview_button').hide(0);
 if (button == "dna_button"){
   $('#rc_button').show(0);
   $('#pro_button').show(0);}
 else if (button == "rc_button"){
   $('#dna_button').show(0);
   $('#pro_button').show(0);}
 else{
  $('#dna_button').show(0);
  $('#rc_button').show(0);
  }
}

function onEnter(e){
  if (!e){ 
   var e = window.event;}
  if(e.which == 13){
    redefine();}
}
function display_feat_info(html){
 $('#feature_info').html(html).show(pageObj.speed);
}


function get_blast_info(){
  var url = location.href;
  parse_url(['args__url','args__'+url],[blastSeq]);
}

function blastSeq() {
 dsid = myObj.dsid || 0;
 chr=myObj.chr || 0;
 featid=myObj.featid || 0;
 up = $('#upstream').val() || 0;
 down = $('#downstream').val() || 0;
 rc = 0;
 if ($('.rc_button').is(':hidden')==true){
   rc = 1;}
 if (featid) {
 window.open('CoGeBlast.pl?featid='+featid+'&upstream='+up+'&downstream='+down+'&rc='+rc);}
 else {
 window.open('CoGeBlast.pl?chr='+chr+'&upstream='+up+'&downstream='+down+'&dsid='+dsid+'&rc='+rc);
 }
}

/*
function waiting(tag,rc) {
  var seq_length;
  if (typeof rc == 'undefined'){
    rc = myObj.rc || 0;}
  if(myObj.featid){
      seq_length = ((myObj.stop)*1 - (myObj.start)*1);}
  else{
      seq_length = ((myObj.stop)*1 + (myObj.start)*1);}
  //else{
  //html = html.replace(/<.+>/g,"");
  //html = html.replace(/<\/pre>$/,"");
    //seq_length = html.length;}
  //alert(seq_length);
  if ((rc==2)&&(seq_length > 80000)){
     $('#'+tag).html('<font class="loading dna">Loading. . .</font>');}
  else if (seq_length > 400000){
  //alert(html+' is '+seq_length+' chars long'); 
  //if (
    $('#'+tag).html('<font class="loading dna">Loading. . .</font>');}
  else{
    return;}
}

*/

function get_feats(){
$('#feat_annos').toggle(0);
$('#hide_annotation_button').toggle(0);
$('#annotation_button').toggle(0);
var hidden = $('#feat_annos').is(':hidden');
if (hidden == true){
 return;}
//waiting('annotation');
}

//obsolete, no longer needed; used for copy+paste problem before using text area
// function make_focus() {
//   document.nt_stream.upstream.focus();
// }

function redefine(){
  if(! isNaN($('#addup').val())) {
  var up = $('#upstream').val()*1-$('#addup').val()*1;
  var down = $('#downstream').val()*1+$('#adddown').val()*1;
  }
  $('#upstream').val(up);
  $('#downstream').val(down);
  myObj.start=$('#upstream').val();
  myObj.stop=$('#downstream').val();
  get_sequence(myObj.rc,myObj.pro,1);
  $('#addup').val(0);
  $('#adddown').val(0);
}

function get_sequence(rc,pro,add){
  //waiting('seq_text',rc);
  if (typeof pro == 'undefined'){
  pro=myObj.pro || 0;}
  else{
  myObj.pro=pro;}
  if (typeof rc == 'undefined'){
  rc = myObj.rc || 0;}
  else{
  myObj.rc=rc;}
  //alert(rc);
  get_seq(['args__featid', 'args__'+myObj.featid, 'args__pro', 'args__'+pro, 'args__rc', 'args__'+rc, 'args__chr', 'args__'+myObj.chr, 'args__dsid', 'args__'+myObj.dsid, 'args__featname', 'args__'+myObj.featname, 'args__upstream', 'upstream', 'args__downstream', 'downstream', 'args__start', 'args__'+myObj.start,'args__stop', 'args__'+myObj.stop,'args__add', 'args__'+add],['seq_text']);
  //alert($('#seq_text').html());
}


</SCRIPT>
</TMPL_IF>
<TMPL_IF NAME=SEQ_BOX>
     <DIV id="seq">
      <TABLE>
       <TR>
        <TD>
        <textarea id=seq_text name=seq_text class=backbox readonly ondblclick="this.select();" style="height: 400px; width: 750px; overflow: auto;"></textarea>
	</TD>
       <TMPL_VAR NAME=FEAT_INFO>
       </TR>
      </TABLE>
 </div>
</TMPL_IF>
<TMPL_IF NAME=BOTTOM_BUTTONS>
  <DIV id="dynamic_button">
  <TABLE>
   <TR>
      <TD align=right valign="top">
       <DIV class="seqview_button dna_button>" style="display: none" id="dna_button"><input type=button value="DNA Sequence" onClick="dynamic_buttons('dna_button');get_sequence(0,0);gen_title(['args__rc','args__0','args__pro','args__0'],['box_name']);"></DIV>     
      </TD>
      <TD align=right valign="top">
      <DIV class="seqview_button rc_button>" id="rc_button"><input type=button value="Reverse Complement" onClick="dynamic_buttons('rc_button');get_sequence(1,0);gen_title(['args__rc','args__1','args__pro','args__0'],['box_name']);"></DIV>
      </TD>
      <TD align=right valign="top">
         <DIV class="seqview_button pro_button>" id="pro_button"><input type=button value="<TMPL_VAR NAME=PROTEIN>" onClick="dynamic_buttons('pro_button');get_sequence(0,1);gen_title(['args__rc','args__0','args__pro','args__1','args__sixframe','args__<TMPL_VAR NAME=SIXFRAME>'],['box_name']);"></DIV>
      </TD>
      <!--get_seq(['args__featid', 'args__<TMPL_VAR NAME=FEATID>', 'args__pro', 'args__<TMPL_VAR NAME=PRO>', 'args__rc', 'args__<TMPL_VAR NAME=RC>', 'args__chr', 'args__<TMPL_VAR NAME=CHR>', 'args__dsid', 'args__<TMPL_VAR NAME=DSID>', 'args__featname', 'args__<TMPL_VAR NAME=FEATNAME>', 'args__upstream', 'upstream', 'args__downstream', 'downstream', 'args__start', 'args__<TMPL_VAR NAME=START>','args__stop', 'args__<TMPL_VAR NAME=STOP>', 'args__strand', 'args__<TMPL_VAR NAME=STRAND>', 'args__add', 'args__<TMPL_VAR NAME=ADD>'],[get_sequence]);gen_title(['args__rc', 'args__<TMPL_VAR NAME=TITLE_RC>', 'args__pro', 'args__<TMPL_VAR NAME=PRO>'],['box_name']);-->
     <TMPL_IF NAME=FIND_FEATS>
     <TD align=right valign="top">
     <DIV id="annotation_button"> <input type=button value="Find Features in Sequence" onClick="get_feats();find_feats(['args__start', 'upstream', 'args__stop', 'downstream', 'args__chr', 'args__'+myObj.chr, 'args__dsid', 'args__'+myObj.dsid],['annotation']);"></DIV>
     <DIV id="hide_annotation_button" style="display: none"> <input type=button value="Hide Features" onClick="get_feats();"></DIV>
     </TMPL_IF>
     </TD>
     <TD align=right valign="top">
     <DIV id="blast_button"><input type=button value="Blast Sequence" onClick="blastSeq()"></DIV>
    </TD>
   </TR>
  </TABLE>
  </DIV>

</TMPL_IF>

<TMPL_IF NAME="ADDITION">
<DIV id="feat_annos" style="display: none">
<TABLE>
 <TR>
  <TD>
  <div id = "maketable"></div>
</Table>
</DIV>
   <div id=extend_title class="seqbackbox"><font class="oblique"><TMPL_VAR NAME="EXTEND"></font></div>
  <table>
 <TR style="float:left"> 
<!--    <form id="nt_stream" name="nt_stream"> -->
  <TD>
   <TMPL_VAR NAME = "UPSTREAM">
   </td>
   <td>
   <INPUT type="text" id="upstream"  onkeypress="onEnter(event);" class="backbox" value= "<TMPL_VAR NAME="UPVALUE">">
   </td>
   <TD>
   <TMPL_VAR NAME="DOWNSTREAM">
   </td>
   <td>
   <INPUT type="text" id="downstream" onkeypress="onEnter(event);" class="backbox" value= "<TMPL_VAR NAME="DOWNVALUE">">
  </TD>
<!--    </form> -->
  </TR>
  <TMPL_IF NAME=ADD_EXTRA>
  <TR style="float:left">
  <TD>
  OR
  </td>
   <TD>
     Add to Upstream:
    </td>
   <td>
   <INPUT type="text" id="addup"  onkeypress="onEnter(event,1);" class="backbox" value= "0">
     </td>
     <TD >
     Add to Downstream: 
    </td>
   <td>
     <INPUT type="text" id="adddown" onkeypress="onEnter(event,1);" class="backbox" value= "0">
   </td>
  </tr>
  </TMPL_IF>
   </TMPL_IF>
   <TMPL_IF NAME="FEATURE">

  <TR>
   <TD align = left valign = "middle">
   <input type = button value = "Reset" id="reset" onClick="reset_updown();get_sequence();">
   <!--<input type=button value="Select Sequence" id="select" onClick="selectText()">-->
      <input type= button value ="Add to Sequence" id = "add_to" onClick="redefine();"> 
   </TMPL_IF>
   <TMPL_IF NAME="RANGE">
    <TR>
     <TD>
      <input type= button value ="Redefine Sequence" id = "add_to" onClick="redefine();"> 
   </TMPL_IF>

<TMPL_IF NAME="REST">
   </TR>
 </TABLE>
</TMPL_IF>

<TMPL_IF NAME="FEATUREBOX">
 <TABLE>
   <TR>
   <TD align=right valign="top">
    <TMPL_VAR NAME="LISTFEATURES">
   </TR>
 </TABLE>
</TMPL_IF>

