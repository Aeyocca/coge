<TMPL_IF NAME="FRONT_PAGE">

<script language="javascript">

function dataset_chain(val) {
 if (val) {kaj.GS('org_list', val);}
 kaj.GS('ds_list','<font class="loading1. . ."></font>');
 kaj.GS('ds_info','<input type=hidden id = "chr">');
 kaj.GS('chr_info','<input type=hidden id = "ds_id">');
 get_dataset(['org_id'],[dataset_info_chain]);
}

function dataset_info_chain(val) {
 kaj.GS('chr_info','<font class="loading"></font>');
 kaj.GS('ds_info','<input type=hidden id = "chr"><font class="loading">loading. . .</font>');
 kaj.GS('viewer','<font class="loading"></font>');
 kaj.GS('get_seq','');
 if (val) {kaj.GS('ds_list', val);}
 get_dataset_info(['ds_id'],[dataset_info_chr_chain]);
}

function dataset_info_chr_chain(val) {
 kaj.GS('chr_info','<input type=hidden id = "ds_id"><font class="loading">loading. . .</font>');
 kaj.GS('ds_info','<input type=hidden id = "chr"><font class="loading">loading. . .</font>');
 kaj.GS('viewer','<font class="loading"></font>');
 kaj.GS('get_seq','');
 if (val) {kaj.GS('ds_info', val); kaj.GS('chr_info','<font class="loading">searching for features. . .</font>');}
 get_dataset_chr_info(['ds_id', 'chr'],['chr_info', 'viewer', 'get_seq']);
}

function get_organism_name_chain(val)
{
 kaj.GS('org_list', '<input type=hidden id = "org_id"><font class="loading"></font>');
 kaj.GS('ds_list','<input type=hidden id = "ds_id">');
 kaj.GS('chr_info','');
 kaj.GS('ds_info','<input type=hidden id = "chr">');
 kaj.GS('viewer','');
 get_orgs(['args__'+val], [dataset_chain]);	 

}

function launch_viewer (dsd, chr) {
 x = kaj.G('x');
 z = kaj.G('z');
 if (z > 12) {z=12;}
 link =  "GeLo.pl?z="+z+"&INITIAL_CENTER="+x+",0&ds="+dsd+"&chr="+chr;
 window.location=link;
}

</script>
<TABLE>
 <TR>
  <TD valign=top>
   <DIV class = "oblique">Organisms</DIV>
   <DIV id="org_name"><TMPL_VAR NAME="ORG_NAME"></DIV>
   <DIV id="blah">Organism Name: <input type="text" size=10 value="" name = "org_name" id="org_name" onKeyUp='get_organism_name_chain(this.value);'></DIV>
   <DIV id="org_list"><TMPL_VAR NAME="ORG_LIST"></DIV>
   <DIV id="viewer"></DIV>
   <DIV id="get_seq"></DIV>
  <TD valign=top>
   <DIV class = "oblique">Datasets</DIV>
   <DIV id="ds_list"><TMPL_VAR NAME="DI_LIST"></DIV>

  <TD valign=top>
   <DIV class = "oblique">Dataset information</DIV>
   <DIV id="ds_info"><TMPL_VAR NAME="DS_INFO"></DIV>
   <DIV id="chr_info"><TMPL_VAR NAME="CHR_INFO"></DIV>

</TABLE>
<IMG SRC = "picts/table/spacer-1x1.png" onload="dataset_chain();">

<TMPL_ELSE>
<style>

#container {
  width: 600px;
  height: 345;
  position:absolute;
  border: 1px solid #ccc;
}

</style>

<script>

connect(window,'onload',myInit);
var gb;
function myInit(){
    gb = new Tiler('container',[config]);
    connect('zoomin','onclick',function(){gb.zoom(1)})
    connect('zoomout','onclick',function(){gb.zoom(-1)})
    connect('container','onmousemove',gb,tmouse);
    connect('container','onclick',query);
    connect('go2center','onclick',function(){gb.setCenter($('bploc').value,0)});
    // TOOD for anything with class function, connect element with
    // id = fred to function fred(){ }
}
function rw2pix(e){
    $('pixloc').value = gb.rw2pix($('bploc').value,0)[0];
}
function tmouse(e){
  var mx =  e.mouse().page.x;
  var ex = getElementPosition(e.src()).x;
  $('bploc').value = this.pix2rw(mx - ex,0)[0];
  //rw2pix();
}
var qurl = '/CoGe/FeatAnno.pl?no_org=1&';

function query(e){
   var mx = e.mouse().page.x;
   var ex = getElementPosition(e.src()).x;
   var pixelpos = mx - ex;
   var bppos = gb.pix2rw(pixelpos,0)[0];
   placeanno('<font class="loading">Loading annotations for position '+bppos+'. . .</font>');
   var url = qurl + 'chr='+ $('chr').value + '&ds='+$('ds').value +
   '&loc='+bppos;
   jfetch(url, 'info');
}

function placeanno(stuff) {
 //  document.info.info.value = stuff;
  kaj.GS('info', stuff);
}

</script>

<form action='javascript:;' >
<input id='iw' type ='hidden' value=256 />
<input id='chr' type ='hidden' value='<TMPL_VAR NAME=CHR>' />
<input id='ds' type ='hidden' value='<TMPL_VAR NAME=DS>' />
<input id='x' type ='hidden' value='<TMPL_VAR NAME=X>' />
<input id='xloc' type ='hidden' value='<TMPL_VAR NAME=XLOC>' />

Nucleotide: <input class = "backbox" type='text' id='bploc' value='' size=10>
<input type='button' id='go2center' value='re-center' /> <br>
<!--<input class = "backbox" type='text' size = "10" id='center' value=100000>-->
<!--Pixel: <input class = "backbox" type='text' id='pixloc' value='' size =4><br/>-->
<button id='zoomin' name='zoomin' class="tileClass" > Zoom In </button>
<button name='zoomout' id='zoomout' class="tileClass" > Zoom Out </button>
Current Zoom: <input type ='text' class = "backbox" id='z' value='<TMPL_VAR NAME=Z>' size = 2>
<br>
Organism: <font class="species"><TMPL_VAR NAME=ORG></font>
Dataset: <font class="species"><TMPL_VAR NAME=DS_NAME></font>
<div id='container' class="tileClass" style='position:relative;left:6px;top:10px;width:1200px;height:350px;border:1px solid black' > </div>
<div id ='info' style='position:relative;left:6px;top:10px;width:1200px;height:400px'><FORM NAME="info"></FORM></div>
</form>
<br>
<div class = "small">Click on the map to view feature information at that position </div>
<div class = "small">Click and drag the map to move genomic view left and right</div>
</TMPL_IF>
