<TMPL_IF NAME="FRONT_PAGE">

<script language="javascript">

function dataset_chain() {
 kaj.GS('di_list','<font class="loading"></font>');
 kaj.GS('di_info','<font class="loading"></font>');	
 kaj.GS('chr_info','<font class="loading"></font>');	
 get_data_info(['org_id'],[dataset_info_chain]);
}

function dataset_info_chain(val) {
 kaj.GS('chr_info','<font class="loading"></font>');	
 kaj.GS('di_info','<font class="loading">loading. . .</font>');
 kaj.GS('viewer','<font class="loading"></font>');
 if (val) {kaj.GS('di_list', val);}
 get_data_info_info(['di_id'],[dataset_info_chr_chain]);
}

function dataset_info_chr_chain(val, chr) {
 kaj.GS('chr_info','<font class="loading">loading. . .</font>');
 kaj.GS('viewer','<font class="loading"></font>');	
 if (val) {kaj.GS('di_info', val); kaj.GS('chr_info','');}
 kaj.GS('chr_info','<font class="loading">searching for features. . .</font>'); 
 get_data_info_chr_info(['di_id', 'chr'],['chr_info', 'viewer']);
}

function launch_viewer (did, chr) {
 x = kaj.G('x');
 z = kaj.G('z');
 link =  "GeLo.pl?z="+z+"&x="+x+"&di="+did+"&chr="+chr;
 window.location=link;
}

</script>
<TABLE>
 <TR>
  <TD valign=top>
   <DIV class = "oblique">Organisms</DIV>
   <DIV id="org_list"><TMPL_VAR NAME="ORG_LIST"></DIV>
   <DIV id="viewer"></DIV>
  <TD valign=top>
   <DIV class = "oblique">Datasets</DIV>
   <DIV id="di_list"><TMPL_VAR NAME="DI_LIST"></DIV>

  <TD valign=top>
   <DIV class = "oblique">Dataset information</DIV>
   <DIV id="di_info"><TMPL_VAR NAME="DI_INFO"></DIV>
   <DIV id="chr_info"><TMPL_VAR NAME="CHR_INFO"></DIV>

</TABLE>
<IMG SRC = "picts/table/spacer-1x1.png" onload="dataset_chain();">

<TMPL_ELSE>


<form action='javascript:;' >
<input id='iw' type ='hidden' value=256 />
<input id='chr' type ='hidden' value='<TMPL_VAR NAME=CHR>' />
<input id='di' type ='hidden' value='<TMPL_VAR NAME=DI>' />
<input id='z' type ='hidden' value='<TMPL_VAR NAME=Z>' />
<input id='x' type ='hidden' value='<TMPL_VAR NAME=X>' />
<input id='xloc' type ='hidden' value='<TMPL_VAR NAME=XLOC>' />
<div>Click on the map to view feature information at that position </div>
<div>Click and drag on the map to move genomic view left and right</div> 
<button id='zi' name='zi' class="tileClass" > Zoom In </button>
<button name='zo' id='zo' class="tileClass" > Zoom Out </button> <font class="small">(zoom feature not yet working. . .sorry!)</font>

<div id='container' class="tileClass" style='position:relative;left:6px;top:10px;width:800px;height:350px;border:1px solid black' > </div>
<div id ='info' style='position:relative;left:6px;top:10px;width:800px;height:200px'><FORM NAME="info"></FORM></div>
</form>

<script>

var omap = new Tiler('container',[config]);

var zi = G('zi');
addEvent(zi,'click',function(){omap.zoom(1)});
addEvent(G('zo'),'click',function(){omap.zoom(-1)});

addEvent(G('container'),'click',query);
var qurl = '/CoGe/FeatAnno.pl?';

function query(e){
   var xy = e.getItemXY(); 
   xy = this.pix_to_real_world(xy[0],xy[1])[0];
   placeanno('<font class="loading">Loading annotations for position '+xy+'. . .</font>'); 
   var url = qurl + 'chr='+ G('chr').value + '&di='+G('di').value + '&loc='+ xy;
   jfetch(url,placeanno);
}

function placeanno(stuff) {
 //  document.info.info.value = stuff; 
  kaj.GS('info', stuff);
}

</script>


</TMPL_IF>
