<TMPL_IF NAME="FRONT_PAGE">

<script language="javascript">

function dataset_chain() {
 kaj.GS('di_list','<font class="loading"></font>');
 kaj.GS('di_info','<font class="loading"></font>');	
 kaj.GS('chr_info','<font class="loading"></font>');	
 get_data_info(['org_id'],[dataset_info_chain]);
}

function dataset_info_chain(val) {
 kaj.GS('chr_info','<font class="loading"></font>');	
 kaj.GS('di_info','<font class="loading">loading. . .</font>');
 kaj.GS('viewer','<font class="loading"></font>');
 if (val) {kaj.GS('di_list', val);}
 get_data_info_info(['di_id'],[dataset_info_chr_chain]);
}

function dataset_info_chr_chain(val, chr) {
 kaj.GS('chr_info','<font class="loading">loading. . .</font>');
 kaj.GS('viewer','<font class="loading"></font>');	
 if (val) {kaj.GS('di_info', val); kaj.GS('chr_info','');}
 kaj.GS('chr_info','<font class="loading">searching for features. . .</font>'); 
 get_data_info_chr_info(['di_id', 'chr'],['chr_info', 'viewer']);
}

function launch_viewer (did, chr) {
 x = kaj.G('x');
 z = kaj.G('z');
 if (z > 12) {z=12;}
 link =  "GeLo.pl?z="+z+"&INITIAL_CENTER="+x+",0&di="+did+"&chr="+chr;
 window.location=link;
}

</script>
<TABLE>
 <TR>
  <TD valign=top>
   <DIV class = "oblique">Organisms</DIV>
   <DIV id="org_list"><TMPL_VAR NAME="ORG_LIST"></DIV>
   <DIV id="viewer"></DIV>
  <TD valign=top>
   <DIV class = "oblique">Datasets</DIV>
   <DIV id="di_list"><TMPL_VAR NAME="DI_LIST"></DIV>

  <TD valign=top>
   <DIV class = "oblique">Dataset information</DIV>
   <DIV id="di_info"><TMPL_VAR NAME="DI_INFO"></DIV>
   <DIV id="chr_info"><TMPL_VAR NAME="CHR_INFO"></DIV>

</TABLE>
<IMG SRC = "picts/table/spacer-1x1.png" onload="dataset_chain();">

<TMPL_ELSE>
<style>

#container {
  width: 600px;
  height: 345;
  position:absolute;
  border: 1px solid #ccc;
}

</style>

<script>

connect(window,'onload',myInit);
var gb;
function myInit(){
    gb = new Tiler('container',[config]);
    connect('zoomin','onclick',function(){gb.zoom(1)})
    connect('zoomout','onclick',function(){gb.zoom(-1)})
    connect('container','onmousemove',gb,tmouse);
    connect('container','onclick',query);
    connect('go2center','onclick',function(){gb.setCenter($('bploc').value,0)});
    // TOOD for anything with class function, connect element with 
    // id = fred to function fred(){ }
}
function rw2pix(e){
    $('pixloc').value = gb.rw2pix($('bploc').value,0)[0]; 
}
function tmouse(e){
  var mx =  e.mouse().page.x;
  var ex = getElementPosition(e.src()).x;
  $('bploc').value = this.pix2rw(mx - ex,0)[0];
  rw2pix();
}
var qurl = '/CoGe/FeatAnno.pl?';

function query(e){
   var mx = e.mouse().page.x;
   var ex = getElementPosition(e.src()).x;
   var pixelpos = mx - ex;
   var bppos = gb.pix2rw(pixelpos,0)[0];
   placeanno('<font class="loading">Loading annotations for position '+bppos+'. . .</font>'); 
   var url = qurl + 'chr='+ $('chr').value + '&di='+$('di').value +
   '&loc='+bppos;
   jfetch(url, 'info');
}

function placeanno(stuff) {
 //  document.info.info.value = stuff; 
  kaj.GS('info', stuff);
}

</script>

<form action='javascript:;' >
<input id='iw' type ='hidden' value=256 />
<input id='chr' type ='hidden' value='<TMPL_VAR NAME=CHR>' />
<input id='di' type ='hidden' value='<TMPL_VAR NAME=DI>' />
<input id='x' type ='hidden' value='<TMPL_VAR NAME=X>' />
<input id='xloc' type ='hidden' value='<TMPL_VAR NAME=XLOC>' />

Nucleotide: <input class = "backbox" type='text' id='bploc' value='' size=10>
<input type='button' id='go2center' value='re-center' /> <br>
<!--<input class = "backbox" type='text' size = "10" id='center' value=100000>-->
<!--Pixel: <input class = "backbox" type='text' id='pixloc' value='' size =4><br/>-->
<button id='zoomin' name='zoomin' class="tileClass" > Zoom In </button>
<button name='zoomout' id='zoomout' class="tileClass" > Zoom Out </button>
Current Zoom: <input type ='text' class = "backbox" id='z' value='<TMPL_VAR NAME=Z>' size = 2>
<br>
Organism: <font class="species"><TMPL_VAR NAME=ORG></font>
Dataset: <font class="species"><TMPL_VAR NAME=DS></font>
<div id='container' class="tileClass" style='position:relative;left:6px;top:10px;width:800px;height:350px;border:1px solid black' > </div>
<div id ='info' style='position:relative;left:6px;top:10px;width:800px;height:200px'><FORM NAME="info"></FORM></div>
</form>
<br>
<div>Click on the map to view feature information at that position </div>
<div>Click and drag the map to move genomic view left and right</div> 
</TMPL_IF>
