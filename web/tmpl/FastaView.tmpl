<script src="./js/sswap.js"></script>
<SCRIPT language="JavaScript">

function update_seqs(prot, text)
 {
  $('#seq_text').val("loading . . .");
  var name_only = 0;
  if ($('#name_only')[0].checked) {name_only = 1};
  var upstream = 0;
  var downstream =0;
  if ($('#upstream').val()) {upstream=$('#upstream').val()};
  if ($('#downstream').val()) {downstream=$('#downstream').val()};
  pageObj.prot=prot;
  if (prot)
   {
    if (text)
     {
       var url=window.location+";prot=1;text=1;no="+name_only;
       window.location =url;
     }
    get_seqs(['args__fids','fids', 'args__textbox','args__1','args__prot','args__1','args__name_only','args__'+name_only, 'args__gstid','gstid'],['seq']);
    $('#prot_button').hide();
    $('#prot_text_button').show();
    $('#dna_button').show();
    $('#add_seq').hide();
    $('#dna_text_button').hide();
    $('.prot_option').show();
   }
  else
   {
    if (text)
     {
       var url=window.location+";text=1;no="+name_only+";up="+upstream+";down="+downstream;
       window.location =url;
     }
 get_seqs(['args__fids','fids', 'args__textbox','args__1','args__prot','args__0','args__name_only','args__'+name_only, 'args__gstid','gstid', 'args__upstream','args__'+upstream, 'args__downstream','args__'+downstream],['seq']);
    $('#prot_button').show();
    $('#prot_text_button').hide();
    $('#dna_button').hide();
    $('#add_seq').show();
    $('#dna_text_button').show();
    $('.prot_option').hide();
   }
 }


function post_to_SSWAP() {
 var myseq = $('#seq_text').val();
 var jsonRRG= {
    "prefix": {
        "data": "http://sswapmeet.sswap.info/data/",
        "mime": "http://sswapmeet.sswap.info/mime/",
        "seq": "http://sswapmeet.sswap.info/sequence/"
    },
    "http://sswap.info/examples/resources/canonical/canonicalResource": {},
    "mapping": {"_:subject" : "_:object"},
    "definitions" : {
    		      "_:subject" : {},
		      "_:object" : {
		      		     "rdf:type" : "seq:FASTA",
				     "data:literalData" : myseq
				   }
		    },
 };
//jsonRRG.definitions."_:object"."_data:literalData" = myseq;
var jsonString = JSON.stringify(jsonRRG);
var url = "http://sswap.iplantcollaborative.org/ipc/create-pipeline-with-rrg";
 var myForm = document.createElement("FORM");
 myForm.method="post" ;
 myForm.action=url;
 myForm.setAttribute("target", "_blank");
 var myInput = document.createElement("textarea");
 myInput.name="rrg";
 myInput.value=jsonString;
 myForm.appendChild(myInput);
 document.body.appendChild(myForm);
 myForm.submit();
 document.body.removeChild(myForm);
}

function post_to_target () {
 seq = $('#seq_text').val().replace(/\n/g,":::");
// seq = escape(seq);
 var url;
 if (pageObj.prot) {url="http://target.iplantcollaborative.org/v3.3_TATE_protein_CoGe_start.php"}
 else {url = "http://target.iplantcollaborative.org/v3.3_TATE_dna_CoGe_start.php";} 
 var myForm = document.createElement("form");
 myForm.method="post" ;
 myForm.action=url;
 myForm.setAttribute("target", "_blank");
 var myInput = document.createElement("input");
 myInput.setAttribute("name", "coge_query");
 myInput.setAttribute("value",seq);
 myForm.appendChild(myInput);
 document.body.appendChild(myForm);
 myForm.submit();
 document.body.removeChild(myForm);
}

function post_to_prosite () {
 var seq = $('#seq_text').val();
 seq = seq.replace(/\*/g,"");
 var url = "http://prosite.expasy.org/cgi-bin/prosite/PSScan.cgi";
 var myForm = document.createElement("FORM");
 myForm.method="post" ;
 myForm.action=url;
 myForm.setAttribute("name", "theForm");
 myForm.setAttribute("target", "_blank");
 var myInput = document.createElement("textarea");
 myInput.name="seq";
 myInput.value=seq;
 myForm.appendChild(myInput);
 document.body.appendChild(myForm);
 myForm.submit();
 document.body.removeChild(myForm);
}

function post_to_phylogeny_fr () {
 var seq = $('#seq_text').val();
 seq = seq.replace(/\*/g,"");
 var url = "http://www.phylogeny.fr/version2_cgi/simple_phylogeny.cgi";
 var myForm = document.createElement("FORM");
 myForm.method="post" ;
 myForm.action=url;
 myForm.setAttribute("target", "_blank");
 var myInput = document.createElement("textarea");
 myInput.name="task_data_input";
 myInput.value=seq;
 myForm.appendChild(myInput);
 document.body.appendChild(myForm);
 myForm.submit();
 document.body.removeChild(myForm);

}

$(document).ready(function()
  {
   prot = <TMPL_VAR NAME=PROT>;
    pageObj.prot=prot; 
    if (prot)
     {
      $('#prot_button').hide();
      $('#dna_text_button').hide();
      $('.prot_option').show();
      $('.dna_option').hide();
     }
    else
     {
      $('#prot_text_button').hide();
      $('#dna_button').hide();
      $('.prot_option').hide(); 
      $('.dna_option').show();
     }
  });
</script>


<TABLE>
 <TR>
  <TD><div id=seq>	
   <TMPL_VAR NAME="SEQ">
   </div>
</TABLE>
<TMPL_VAR NAME="FIDS">


<TMPL_IF NAME=BOTTOM_BUTTONS>
  <input type="checkbox" name="name_only" id="name_only" value=0 onclick="update_seqs(0);"/>&nbsp&nbsp Only use feature names in header.
  <DIV id="dynamic_button">
  <TABLE>
   <TR>
   <td><span class='ui-button ui-corner-all'id="prot_button" onclick="update_seqs(1)">Protein Sequence</span>
   <td><span class='ui-button ui-corner-all'id="dna_button" onclick="update_seqs(0)">DNA Sequence</span>
   <td><span class='ui-button ui-corner-all'id="prot_text_button" onclick="update_seqs(1,1)">Plain Text</span>
   <td><span class='ui-button ui-corner-all'id="dna_text_button" onclick="update_seqs(0,1)"> Plain Text</span>
   <td><span class='ui-button ui-corner-all'id="blast_button"onclick="window.open('CoGeBlast.pl?featid='+$('#fids').val())">CoGe Blast</span> 
 </TR>
  </TABLE>
<span id=add_seq class=small>
  Add Upstream (5'): <INPUT type="text" id="upstream" value= "<TMPL_VAR NAME="UP">" size=6>
  Add Downstream (3'): <INPUT type="text" id="downstream" value="<TMPL_VAR NAME="DOWN">" size=6>
  <span class='ui-button ui-corner-all'id="dna_text_button" onclick="update_seqs(0)">Add Seq</span>
  </span>
<br>

  Off site tools:<br>
<!-- ALL SEQUENCES -->
    <table class="ui-widget-content ui-corner-all">
    <tr align=top>
    <td><span onClick="post_to_SSWAP();" class='ui-button ui-corner-all'>iPlant Symantic Web</span>

<div id="pipelineButton"></div>





    <td> Some description of what happens
    <tr align=top>
    <td><span onClick="post_to_target();" class='ui-button ui-corner-all'>TARGeT</span>
    <td><span class="link" onclick ="window.open('http://target.iplantcollaborative.org/');"> Tree Analysis of Related Genes and Transposons</span><br>
    <tr align=top>
    <td><span onClick="post_to_phylogeny_fr();" class='ui-button ui-corner-all'>Phylogeny.fr</span>
    <td>One click phylogeny at <a href="http://www.phylogeny.fr" target=_new>Phylogeny.fr</a>
    </table>
<!-- PROTEIN SEQUENCES ONLY -->
  <div class="prot_option">
   <table>
    <tr align=top>
    <td><span onClick="post_to_prosite();" class='ui-button ui-corner-all'>ProSite</span>
    <td>Scan for protein domains at <span class=link onclick="window.open('http://www.expasy.ch/prosite/')">ProSite</span>.  
  </table>
   </div>
 </DIV>

</TMPL_IF>


