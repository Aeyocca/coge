<TMPL_IF NAME="JAVASCRIPT">
<SCRIPT language="JavaScript" type="text/javascript" src="./js/jquery.tablesorter.js"></SCRIPT>
<SCRIPT language="JavaScript" type="text/javascript" src="./js/jquery.tablesorter.parsers.js"></SCRIPT>
<!--<SCRIPT language="JavaScript" type="text/javascript" src="./js/metadata.js"></SCRIPT>-->
<SCRIPT language="JavaScript" type="text/javascript" src="./js/menu.js"></SCRIPT>
<SCRIPT language="JavaScript">

$(document).ready(function(){
  radio_lock($('#bn')[0].checked);
  blast_param_on_select();
  get_displayFeature();
  blast_param([],[animate_params]);
  database_param([],['database']);
  var seqview = <TMPL_VAR NAME=SEQVIEW> || 0;
  if(seqview !=0){
    var featid = <TMPL_VAR NAME=FEATID>;
  if ((featid) && (featid!=0)){
    pageObj.generate_seq_obj = generate_seq_obj(<TMPL_VAR NAME=DSID>,<TMPL_VAR NAME=UPSTREAM>,<TMPL_VAR NAME=DOWNSTREAM>,seqview,<TMPL_VAR NAME=CHR>,<TMPL_VAR NAME=RC>,featid);}
  else{
    pageObj.generate_seq_obj = generate_seq_obj(<TMPL_VAR NAME=DSID>,<TMPL_VAR NAME=UPSTREAM>,<TMPL_VAR NAME=DOWNSTREAM>,seqview,<TMPL_VAR NAME=CHR>,<TMPL_VAR NAME=RC>);}
  }
  //alert(pageObj.dsid);
});

function add_to_list(ds,org){
  var check = $('#'+ds).val();
  if (check){
   alert('You have already added '+org+'.');
   return;
  }
  var html = '<option id='+ds+' value='+ds+'>'+org+'</option>';
  //alert(html);
  $('#blank').remove();
  $('#db_choice').append(html);
  $('#db_choice').sortSelect();
  counting();
}

jQuery.fn.checkCheckboxes = function()
{
	var returnWhat = jQuery([]);
	this.each(
		function()
		{
			var checked = jQuery("input[@type=checkbox]", this).each(
				function()
				{
					this.checked = true;
				}
			).filter(":checked");
			returnWhat = checked;
		}
	);

		returnWhat = this;
};

function update_info_box(featname) {
    $('#overlap_box').html('You have chosen to display the information for '+featname+'. You will be pleased to know that one day some useful info will be here.');
}

jQuery.fn.unCheckCheckboxes = function()
{
	var returnWhat = jQuery([]);
	this.each(
		function()
		{
			var unChecked = jQuery("input[@type=checkbox]", this).each(
				function()
				{
					this.checked = false;
				}
			).filter(":not(:checked)");
			returnWhat = unChecked;
		}
	);
		returnWhat = this;
};

function generate_seq_obj(dsid,upstream,downstream,seqview,chr,rc,featid){
  this.featid=featid;
  this.dsid=dsid;
  this.upstream=upstream;
  this.downstream=downstream;
  this.seqview=seqview;
  this.chr=chr;
  this.rc=rc;
}

function counting(){
  var count = $('#db_choice').getLength();
  $('.count').html('Database count: '+count);
}

function blastOff(){
  var check = $('#db_choice').getLength();
  if(($('#blank').val())||(check==0)){
    alert('You have not selected any databases to blast. You must select at least one.');
    $('#coge_blast').slideDown(pageObj.speed);
    return;
  }
  $('.dropMenu').hide();
  $('.bresults').slideToggle(pageObj.speed);
  $('#blast_results').html('<font class="loading dna">Loading. . .</font>');
  var params = get_params();
  program = params.p;
  expect = params.e;
  job_title = params.j;
  word_size = params.w;
  comp = params.c;
  matrix = params.m
  match_score = params.mm;
  gapcost = params.g;
  seq = params.s;
  var blastable_db = $('#db_choice').getLength(1);
  //alert(blastable_db);
  blastoff_search(['args__program','args__'+program,'args__expect','args__'+expect,'args__job_title','args__'+job_title,'args__wordsize','args__'+word_size,'args__comp','args__'+comp,'args__matrix','args__'+matrix,'args__matchscore','args__'+match_score,'args__gapcost','args__'+gapcost,'args__seq','args__'+seq,'args__blastable','args__'+blastable_db],[blastresults]);
}

// $(document).ready(function(){

function blastresults(html){
  $('#blast_results').html(html);
  $(function(){
  $("#overlap").tablesorter({		
 		sortColumn: 'name',			// Integer or String of the name of the column to sort by.
		sortClassAsc: 'headerSortUp',		// Class name for ascending sorting action to header
		sortClassDesc: 'headerSortDown',	// Class name for descending sorting action to header
		headerClass: 'header',			// Class name for headers (th's)
		widgets: ['zebra'],
		});
 });
}

function update_gapcost(){
  var str = $('#match_score').val();
  $('.gapcosts').hide();
  var num1 = str.substr(0,1);
  var num2 = str.substr(2);
  $('#gapcosts_'+num1+num2).slideToggle(pageObj.speed);
}

$.fn.getLength = function(val){
  var opt_length;
  var blastable;
  this.each(
  	function()
  	{
  		var opts = this.options;
  		opt_length = opts.length;
  		blastable = opts[0].id;
  		if (val){
  		  for(var i=1;i<opts.length;i++)
	  	  {
	  		blastable += ","+opts[i].id;
	  		//need to chopoff last comma
	  	  }
  		}
  	}
  );
  if(val) return blastable;
  else return opt_length;
};

$.fn.sortSelect = function(){
  this.each(
	  function()
	  {
	  	if(this.nodeName.toLowerCase() != "select"){
	  	  return;}
	  	var opts = this.options;
	  	var sortArray = [];
	  	for(var i=0;i<opts.length;i++)
	  	{
	  		sortArray[i] = {
	  				v: opts[i].value,
	  				t: opts[i].text,
	  				d: opts[i].id,
	  				}
	  	}
	  	sortArray.sort(
	  			function(obj1,obj2)
	  			{
	  				obj1t = obj1.t.toLowerCase(),
	  				obj2t = obj2.t.toLowerCase();
	  				if(obj1t == obj2t){
	  				  return 0;}
	  				return obj1t < obj2t ? -1 : 1;
	  			}
	  	);
	  	for(var i=0;i<opts.length;i++)
	  	{
	  		opts[i].id = sortArray[i].d;
	  		opts[i].text = sortArray[i].t;
	  		opts[i].value = sortArray[i].v;
	  	}
	  }
	);
	return this;
};


function get_params(){
 radio = get_radio();
 var word_size = $('#word_size').val();
 var expect = $('#e_value').val();
 var db = $('#blast_db').val();
 var match_mismatch = $('#match_score').val();
 var num1 = match_mismatch.substr(0,1);
 var num2 = match_mismatch.substr(2);
 var gapcost = $('#gapcosts_'+num1+num2).val();
 var job_title = $('#job_title').val();
 var program = $('#'+radio).val();

 var matrix = $('#matrix').val();
 var comp = $('#comp_adj').val();
 var seq = $('#seq_box').val();
 return {w : word_size, e : expect, db : db,g : gapcost,j : job_title,p : program,mm: match_mismatch,m : matrix,c : comp,s : seq};
}

function get_seq(url) {
 if (url == 1)
  {alert('You have not selected a BLAST program! Please select a program to run.');}
 else {
 var params = get_params();
 seq = params.s;
 seq = seq.replace(/\n/,'%0D');
 //alert('seq: '+seq);
 db = params.db;
 expect = params.e;
 job_title = params.j;
 word_size = params.w;
 comp = params.c;
 matrix = params.m
 match_score = params.mm;
 
 url = url+'&DATABASE='+db+'&EXPECT='+expect+'&QUERY='+seq+'&JOB_TITLE='+job_title+'&WORD_SIZE='+word_size;
 
 if (program == 'blastn') {
   window.open(url+'&MATCH_SCORES='+match_score);
 }

else {
 if ($('#comp_adj').is(':hidden')) {window.open(url+'&MATRIX_NAME='+matrix);}
 else {window.open(url+'&MATRIX_NAME='+matrix+'&COMPOSITION_BASED_STATISTICS='+comp);}
 }
}
}

function radio_lock(display) {
  if (display == false) {
  animate_section("#select_n", "hide",0);
  animate_section("#select_p", "slideDown");
  }
  else {
  animate_section("#select_p", "hide",0);
  animate_section("#select_n", "slideDown");
  }
}

function select_blast() {
  radio = get_radio();
  //alert(radio);
  get_url([radio],[get_seq]);
}

function get_radio(){
   var radio = $('#bn')[0].checked;
  if (radio == true){
   radio = "blast_type_n";}
  else{
   radio = "blast_type_p";}
  return radio;
}

function check_seq_for_blast() {
 dsid = pageObj.dsid;
 featid = pageObj.featid;
 chr = pageObj.chr;
// radio2 = kaj.GS('bn');
// alert('bn');
  if (featid) {
   get_sequence(['args__'+featid,'args__'+dsid,'bn', 'args__'+pageObj.seqview, 'args__'+pageObj.upstream,'args__'+pageObj.downstream,'args__'+pageObj.rc],['seq_box']);
  }
  else if (chr) {
   get_sequence(['args__'+chr,'args__'+dsid,'bn', 'args__'+pageObj.seqview, 'args__'+pageObj.upstream,'args__'+pageObj.downstream],['seq_box']);
   }
  else {
// alert('Im being called!'+accn+dsid+type_name);
  return;
  }
}

function blast_param_on_select() {
 radio = get_radio();
 program = $('#'+radio).val();
 //alert(''+program);
 database_param([radio],['database']);
 if ((program == 'blastx') || (program == 'tblastx')) {
 //alert('Program is true!');
  blast_param(['args__'+"blast_type_p",'args__'+"blast_type_p"],[animate_params]);
  }
  else if ((program == 'blastp') || (program == 'tblastn')) {
  blast_param(['args__'+"blast_type_p"],[animate_params]);}
  else {
   blast_param([],[animate_params]);}
}

function animate_params (html){
  animate_section("#pro_or_nu_param", "hide",0);
  $('#pro_or_nu_param').html(html);
  animate_section("#pro_or_nu_param", "slideDown");
}

function get_displayFeature(){
if (!$('#feature_display').val()){
  return;
}
var stuff = $('#pretty_print_anno').html();
var check = 0;
if ($('#feature_display')[0].checked) {
  check = 1;}
if (stuff){
 toggleFeature("",check);}
else if (check){
get_pretty_print(['args__'+pageObj.featid, 'args__'+pageObj.dsid],[toggleFeature]);}
}

function get_organism_name_chain(val)
{
 get_orgs(['args__'+val], ['org_list']);	 
}

function toggleFeature(html,check) {
 if (html)
 {
   $('#pretty_print_anno').html(html);
   animate_section("#pretty_print_anno", "show");
 }
 else if (check)
 {
   animate_section("#pretty_print_anno", "show");
 }
else {
animate_section("#pretty_print_anno", "hide");
}
}

</SCRIPT>
</TMPL_IF>

<TMPL_IF NAME="BLAST_FRONT_PAGE">
<TABLE width=100%>
 <TR>
 <TD><DIV id=blast_results></DIV></TD>
 </TR>
</TABLE>
<TABLE>
 <TR>
   <TD>
    <input type="button" value="CoGe BLAST" onClick="blastOff();">
   </TD>
   <TD>
     <a href="#" id="ncbi_blast" onClick="select_blast()"><span>NCBI BLAST</span></a>
   </TD>
  </TR>
</TABLE>
<TABLE width=100%>
 <TR>
  <TD>
  <TH colspan="3">
  <DIV class="cogeblast_opts">
   <DIV id = "co" class="topItem" onMouseOver="$('#co').removeClass('topItem').addClass('topItemSelected');" onMouseOut="$('#co').removeClass('topItemSelected').addClass('topItem');" onClick='animate_section("#coge_blast", "slideToggle")'>CoGe BLAST Options:</DIV>
   <DIV class="dropMenu" id="coge_blast" style="display: none">
   <TABLE class="list" >
       <TR>
          <TD>
   	<DIV id="org_name"><TMPL_VAR NAME="ORG_NAME"></DIV>
   	<DIV id="blah">Organism Name: <input type="text" size=10 value="" name = "org_name" id="org_name" onKeyUp='get_organism_name_chain(this.value);'></DIV>
   	<DIV id="org_list"><TMPL_VAR NAME="ORG_LIST"></DIV>
   	  </TD>
   	  <TD valign="middle" align=middle>
   	  <input type="button" id=add value="Add &rarr;  " onClick="get_from_id(['org_id'],[add_to_list]);">
   	  <input type="button" style="display: none" id=remove value="&larr; Remove" onClick="$('#'+$('#db_choice').val()).remove();counting();">
   	  </TD>
           <TD>
              <div id=db_title>Organism Database(s) to BLAST:</DIV>
              <font class="small count">Database count: 0</font>
              <DIV id=db_select><SELECT id="db_choice" SIZE="8" MULTIPLE onClick="$('#add').hide(0);$('#remove').show(0);">
              <option id=blank value=null>No Database Selected</option>
              </SELECT></DIV>
           </TD>
          </TR>
         </TABLE>
</DIV>
</TD>
 </TR>
 <TR>
  <TD>
   <TH colspan="3">
   <DIV class="mainDiv">
   <DIV id = "dr" class="topItem" onMouseOver="$('#dr').removeClass('topItem').addClass('topItemSelected');" onMouseOut="$('#dr').removeClass('topItemSelected').addClass('topItem');" onClick='animate_section("#query_seqs", "slideToggle")'>Query Sequence(s):</DIV>
   <DIV class="dropMenu" id="query_seqs">
   <DIV class="subMenu" style="display:inline;">
   <TABLE> 
    <TR align=left valign=top>
     <TH>Sequences (fasta format)
      <TD><textarea class="backbox" type="textarea" name="seq_box" id ="seq_box" wrap=off cols=80 rows=15><TMPL_VAR NAME="SEQUENCE"></textarea>
      </TD>
      <TD valign="top"> Select a BLAST to run: <br>
       <TABLE>
       <TR>
        <TD valign="top">
         <label><input id=bn type=radio name=blast value="blast_type_n" checked="" onClick="radio_lock($('#bn')[0].checked);check_seq_for_blast();blast_param_on_select();">Nucleotide Sequence</label>
         <br>
          <div id=select_n>
           <select name=blasttype id=blast_type_n onChange="blast_param_on_select()">
            <optgroup label="--- Select BLAST Type ---">
            <option value = "blastn"> blastn
            <option value = "blastx"> blastx
            <option value = "tblastx"> tblastx
           </optgroup>
           </select>
           <br>
          </div>
         <br>
         <label><input id=bn type=radio name=blast value="blast_type_p" onClick="radio_lock($('#bn')[0].checked);check_seq_for_blast();blast_param_on_select()">Protein Sequence</label>
         <br>
          <div id=select_p>
           <select name=blasttype id=blast_type_p>
            <optgroup label="--- Select BLAST Type ---">
            <option value = "blastp"> blastp
            <option value = "tblastn"> tblastn
            </optgroup>
           </select>
           <br>
          </div>
         <br>
         <!--<input type=image name= onClick="get_radio(['args__bn','bn'],[select_blast])">-->
         </TR>
         </TABLE>
      </TD>
   </TR>
   <TR align=left valign=top>
   <TMPL_IF NAME=DISPLAY_FEAT>
   <TD>
    <TABLE>
        <TR>
         <TD><form name=check_feat>
          <input type="checkbox" name="feature_display" id="feature_display" onClick="get_displayFeature();"></form>
         </TD>
         <TD valign="top">
          Click to show feature information
        </TR>
       </TABLE>
    </TD>
    <TD>
     <DIV id=pretty_print_anno></DIV>
    </TD>
    </TMPL_IF>    
    </TR>
  </table>
   </DIV>
   </DIV>
   </DIV>
 </TR>
 <TR>
  <TD>
  <TH colspan="3">
   <DIV class="mainDiv">
   <DIV id = "dr3" class="topItem" onMouseOver="$('#dr3').removeClass('topItem').addClass('topItemSelected');" onMouseOut="$('#dr3').removeClass('topItemSelected').addClass('topItem')" onClick='animate_section("#blast_params", "slideToggle")' >Additional BLAST Options:</DIV>
   <DIV class="dropMenu" id="blast_params">
   <DIV class="subMenu" style="display:inline;">
   <TABLE width=100% id=stuff>
    <TR>
     <TD valign="top">
      <TH align=left valign="top"><u>BLAST Parameters</u><br>
      <TABLE>
       <TR>
	<TD>
	 Job Title
	</TD>
	<TD> 
	 <input id=job_title type=text value="<TMPL_VAR NAME=USER_NAME>'s BLAST">
	</TD>
       </TR>
       <TR>
        <TD>
	  Database
	</TD>
	<TD>
	<DIV id=database></DIV>
       </TR>
       <TR>
	<TD>
	  Filter
 	</TD>
	<TD>
	     <select name=complexity id=complexity>
              <option value = "0"> Off
	      <option value = "L"> Low Complexity
              <option value = "R"> Human Repeats
              <option value = "m"> Mask for Lookup
             </select>
       </TR>
      </TABLE>
     </TD>
     <td width="1" bgcolor="#99ff99"/>
     <TD valign="top">
      <TH align=left valign="top"> <u>BLAST Scoring</u><br>
      <TABLE>
       <TR>
	<TD>
	  E-Value
	</TD>
	<TD>
	    <select name=e_value id=e_value>
             <option value = ".000001"> 1e-6
	     <option value = ".00001"> 1e-5
	     <option value = ".0001"> 0.0001
             <option value = ".001"> 0.001
             <option value = ".01" selected> 0.01
             <option value = ".1"> 0.1
	     <option value = "1"> 1
	     <option value = "10"> 10
             <option value = "100"> 100
            </select>
       </TR>
       <TR>
	<TD>
	   Word size
	</TD>
	<TD>
	 <input type=text id=word_size value="28" size="7">
       </TR>
       <TR>
	<TD>
	  Gap Costs:
       </TD>
	<TD>
	  <select id="gapcosts_1-2" class="gapcosts" style="display: block">
	  	<option value = "0 0"  >Linear</option>   
		<option value = "5 2"  >Existence:  5 Extension: 2</option>				
		<option value = "2 2"  >Existence:  2 Extension: 2</option>				
		<option value = "1 2"  >Existence:  1 Extension: 2</option>
		<option value = "0 2"  >Existence:  0 Extension: 2</option>
		<option value = "3 1"  >Existence:  3 Extension: 1</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>				
	</select>
	<select id="gapcosts_1-3" class="gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "5 2" >Existence:  5 Extension: 2</option>				
		<option value = "2 2"  >Existence:  2 Extension: 2</option>		
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>	
	</select>

	<select id="gapcosts_1-4" class="gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "5 2" >Existence:  5 Extension: 2</option>					
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>	
	</select>
	<select id="gapcosts_2-3" class="gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "4 4"  >Existence:  4 Extension: 4</option>		
		<option value = "2 4"  >Existence:  2 Extension: 4</option>		
		<option value = "0 4"  >Existence:  0 Extension: 4</option>		
		<option value = "3 3"  >Existence:  3 Extension: 3</option>		
		<option value = "6 2"  >Existence:  6 Extension: 2</option>		
		<option value = "5 2" >Existence:  5 Extension: 2</option>		
		<option value = "4 2"  >Existence: 4 Extension: 2</option>		
		<option value = "2 2"  >Existence:  2 Extension: 2</option>				
	</select>
	<select id="gapcosts_4-5" class="gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "12 8" >Existence:  12 Extension: 8</option>		
		<option value = "6 5"  >Existence:  6 Extension: 5</option>		
		<option value = "5 5"  >Existence:  5 Extension: 5</option>		
		<option value = "4 5"  >Existence:  4 Extension: 5</option>		
		<option value = "3 5"  >Existence:  3 Extension: 5</option>	
	</select>
	<select id="gapcosts_1-1" class="gapcosts" style="display: none">
		<option value = "5 2"  >Existence:  5 Extension: 2</option>							
		<option value = "3 2"  >Existence:  3 Extension: 2</option>		
		<option value = "2 2"  >Existence:  2 Extension: 2</option>		
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "4 1"  >Existence:  4 Extension: 1</option>		
		<option value = "3 1"  >Existence:  3 Extension: 1</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>	
      </TR>
      </TABLE>
     </TD>
     <td width="1" bgcolor="#99ff99"/>
     <TD valign="top">
    <DIV id=pro_or_nu_param></DIV>
    </TMPL_IF>
    <TMPL_IF NAME="REST">
     </TR>
    </TABLE>
</DIV>
</DIV>
</DIV>
 </TR>
 </TABLE>
</TMPL_IF>


    <TMPL_IF NAME="BLAST_NU">
     <TH align=left valign="top"><u> Nucleotide Specific Parameters</u><br>
      <TABLE>
       <TR>
	<TD valign="top">
	 Match/Mismatch Scores:
         </TD>
         <TD>
	    <select id=match_score name=match_score onchange="update_gapcost()">
	     <option selected="selected" value="1,-2">1,-2</option>
	     <option value="1,-3">1,-3</option>
	     <option value="1,-4">1,-4</option>
	     <option value="2,-3">2,-3</option>
     	     <option value="4,-5">4,-5</option>
	     <option value="1,-1">1,-1</option>
	 </TD>
       </TR>
      </TABLE>
    </TMPL_IF>
    <TMPL_IF NAME="BLAST_PRO">
     <TH align=left valign="top"><u>Protein Specific Parameters</u><br>
      <TABLE>
       <TR>
        <TD valign="top">
	 Matrix
        </TD>
        <TD>
	     <select name=matrix id=matrix>
              <option value = "PAM30"> PAM30
	      <option value = "PAM70"> PAM70
              <option value = "BLOSUM80"> BLOSUM80
              <option value = "BLOSUM62" selected> BLOSUM62
              <option value = "BLOSUM45"> BLOSUM45
             </select>
       </TR>
       <TMPL_IF NAME=BLAST_PRO_COMP>
       <TR>
        <TD>
	 Compositional adjustments
	</TD>
	<TD>
	     <select name=comp_adj id=comp_adj>
              <option value = "0"> No adjustment
	      <option value = "1" selected> Composition-based statistics
              <option value = "2"> Conditional compositional score matrix adjustment
              <option value = "3"> Universal compositional score matrix adjustment
             </select>
       </TR>
       </TMPL_IF>
      </TABLE>
    </TMPL_IF>
    
    <TMPL_IF NAME=NU_DB>
    <select name=blast_db id=blast_db>
	  <optgroup label="Genomic plus Transcript">
           <option value = "Test/gpipe/9606/allcontig_and_rna"> Human genomic plus transcript
           <option value = "Test/gpipe/10090/allcontig_and_rna"> Mouse genomic plus transcript
	  </optgroup>
	  <optgroup label="Other Databases">
           <option value = "nr" selected> Nucleotide collection (nr/nt)
           <option value = "refseq_rna"> Reference mRNA sequences (refseq_rna)
           <option value = "refseq_genomic"> Reference genomic sequences (refseq_genomic)
           <option value = "est"> Expressed sequence tags (est)
           <option value = "est_others"> Non-human, non-mouse ESTs (est_others)
           <option value = "gss"> Genomic survey sequences (gss)
           <option value = "htgs"> High throughput genomic sequences (HTGS)
           <option value = "pat"> Patent sequences (pat)
           <option value = "pdb"> Protein Data Bank (pdb)
           <option value = "alu"> Human ALU repeat elements (alu_repeat)
           <option value = "dbsts"> Sequence tagged sites (dbsts)
           <option value = "wgs"> Whole-genome shotgun reads (wgs)
           <option value = "env_nt"> Environmental samples (env_nt)
	  </optgroup>
          </select>
    </TMPL_IF>
   
    <TMPL_IF NAME=PRO_DB>
    <select name=blast_db id=blast_db>
	<option value="nr" selected>Non-redundant protein sequences (nr)</option>
	<option value="refseq_protein">Reference proteins (refseq_protein)</option>	
	<option value="swissprot">Swissprot protein sequences(swissprot)</option>
	<option value="pat">Patented protein sequences(pat)</option>
	<option value="pdb">Protein Data Bank proteins(pdb)</option>
	<option value="env_nr">Environmental samples(env_nr)</option>
    </TMPL_IF>

    <TMPL_IF NAME=T_DB>
    <select name=blast_db id=blast_db>
        <option value="nr" selected>Nucleotide collection (nr/nt)</option>
	<option value="refseq_rna">Reference mRNA sequences (refseq_rna)</option>
	<option value="refseq_genomic">Reference genomic sequences (refseq_genomic)</option>
	<option value="est">Expressed sequence tags (est)</option>
	<option value="est_others">Non-human, non-mouse ESTs (est_others)</option>
	<option value="gss">Genomic survey sequences (gss)</option>
	<option value="htgs">High throughput genomic sequences (HTGS)</option>
	
	<option value="pat">Patent sequences(pat)</option>
	<option value="pdb">Protein Data Bank (pdb)</option>
	<option value="alu">Human ALU repeat elements (alu_repeats)</option>
	<option value="dbsts">Sequence tagged sites (dbsts)</option>
	<option value="wgs">Whole-genome shotgun reads (wgs)</option>
	<option value="env_nt">Environmental samples (env_nt)</option>
   </TMPL_IF>
   
   
   <TMPL_IF NAME="OVERLAP_FEATURE_IF">
   <TABLE id="overlap" cellspacing="2" class="resultborder">
   	<THEAD>
         <TR>
          <TH>  </TH>
          <TH class="header">Name</TH>
          <TH class="header">Length</TH>
          <TH class="header">E-Value</TH>
          <TH class="header">Percent ID</TH>
          <TH class="header">Score</TH>
         </TR>
         </THEAD>
         <TBODY>
         <TMPL_LOOP NAME=FEATURE_TABLE>
         <TR id="table_row<TMPL_VAR NAME=FID>" onclick="update_info_box('<TMPL_VAR NAME=FID>')" onmouseover="$('#table_row<TMPL_VAR NAME=FID>').addClass('highlight_tablerows');" onmouseout="$('#table_row<TMPL_VAR NAME=FID>').removeClass('highlight_tablerows');">
          <TD><input type=checkbox id="feature_checkbox<TMPL_VAR NAME=FID>" name="feature_checkbox" value="<TMPL_VAR NAME=FID>"></TD>
          <TD><TMPL_VAR NAME=FEATURE_NAME></TD>
          <TD><TMPL_VAR NAME=FEATURE_LENGTH></TD>
          <TD><TMPL_VAR NAME=FEATURE_EVAL></TD>
          <TD><TMPL_VAR NAME=FEATURE_PID></TD>
          <TD><TMPL_VAR NAME=FEATURE_SCORE></TD>
         </TR>
        </TMPL_LOOP>
        </TBODY>
        </TABLE>
         
   </TMPL_IF>
   
   <TMPL_IF NAME=CHROMOSOMES_IF>
       <TMPL_LOOP NAME=CHROMOSOME_LOOP>
         <TMPL_VAR NAME=DB_NAME>
         <TMPL_VAR NAME=CHR_IMAGE>
         <br>
       </TMPL_LOOP>
   </TMPL_IF>
   
<TMPL_IF NAME=BLAST_RESULTS>
<TABLE width=100%>
  <TR>
    <TD>
   <TH colspan="3">
   <DIV class="mainDiv bresults">
   <DIV id = "br" class="topItem bresults" style="display: none" onMouseOver="$('#br').removeClass('topItem').addClass('topItemSelected');" onMouseOut="$('#br').removeClass('topItemSelected').addClass('topItem');" onClick='animate_section("#results", "slideToggle")'>Blast Results:</DIV>
   <DIV class="dropMenu bresults" id="results">
   <DIV class="subMenu" style="display:inline;">
   <TABLE width=100%>
    <TR>
     <TD align=left valign="top" >
     <DIV id=chromosomes class="bresultdiv resultborder">
     <TMPL_VAR NAME=CHROMOSOMES>
      </DIV>
      Color HSP Hits by: 
      <select name=color_hsp id=color_hsp>
            <option value = "0"> Percent Identity </option>
            <option value = "1"> E-value </option>
            <option value = "2"> Score </option>
            <option value = "3"> Length </option>
     </select>
      </TD>
      <TD>
       <DIV id=result_visual valign="top">
        <DIV id=subject_image>Picture Here</DIV>
        <BR>
        <DIV id=query_image>Another Picture Here</DIV>
        <BR>
        <BR>
        <DIV id=image_info class="resultborder">HSP info box.</DIV>
        </DIV>
      </TD>
      <TD>
       <DIV id=result_features align=right valign="top">
         <form id=feature_list class="bresultdiv">
         <TMPL_VAR NAME="OVERLAP_FEATURE_LIST">
         <input type=button value="Select All" onClick="$('#feature_list').checkCheckboxes()">  <input type=button value="Select None" onClick="$('#feature_list').unCheckCheckboxes()">
         </form>
         <br>
         <DIV id=feature_info class="bresultdiv"><textarea class="backbox resultborder" readonly type="textarea" name="overlap_box" id ="overlap_box" wrap=off cols=55 rows=10>Overlap Features info box</textarea></DIV>
       </DIV>
     </TD>
    <TR>
   </TABLE>
   </TD>
</DIV>
</DIV>
</DIV>
  </TR>
</TABLE>
   </TMPL_IF>