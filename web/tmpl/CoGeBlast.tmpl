<TMPL_IF NAME="JAVASCRIPT">
<link rel="stylesheet" type="text/css" href="/CoGe/css/ui.tabs.css" />
<SCRIPT language="JavaScript" type="text/javascript" src="./js/jquery.tablesorter.2.0.1.js"></SCRIPT>
<SCRIPT language="JavaScript" type="text/javascript" src="./js/ui.tabs.js"></SCRIPT>
<SCRIPT language="JavaScript">

$(document).ready(function(){
  display_correct_radio($('#coge_radio')[0].checked,'coge');
  blast_param_on_select('coge_radio','coge');
  blast_param([],[animate_params]);
  database_param([],['database']);
  
  //Object Generation
  var seqview = <TMPL_VAR NAME=SEQVIEW> || 0;
  if(seqview !=0){
    var featid = "<TMPL_VAR NAME=FEATID>";
    if ((featid) && (featid!=0)){
      seqObj = new generate_seq_obj(<TMPL_VAR NAME=DSID>,<TMPL_VAR NAME=UPSTREAM>,<TMPL_VAR NAME=DOWNSTREAM>,seqview,'<TMPL_VAR NAME=CHR>',<TMPL_VAR NAME=RC>,featid);
    }
    else{
      seqObj = new generate_seq_obj(<TMPL_VAR NAME=DSID>,<TMPL_VAR NAME=UPSTREAM>,<TMPL_VAR NAME=DOWNSTREAM>,seqview,'<TMPL_VAR NAME=CHR>',<TMPL_VAR NAME=RC>);
    }
  }
  //TODO - handle js object error when checking for value when it hasn't been instantiated
  else{
    seqObj = new Object();
  }
   get_seq('coge_radio');
  pageObj.waittime=1000;
   <TMPL_VAR NAME="document_ready">
});

$(document).ready(function(){
  $("#tab > ul").tabs();
});

function generate_seq_obj(dsid,upstream,downstream,seqview,chr,rc,featid){
  this.featid=featid;
  this.dsid=dsid;
  this.upstream=upstream;
  this.downstream=downstream;
  this.seqview=seqview;
  this.chr=chr;
  this.rc=rc;
}

function update_info_box(featid) {
 var table_width = $('#hsp_result_table').width();
 $('#overlap_box').width(table_width);
 if ($('#overlap_box').is(':hidden')) $('#overlap_box').slideDown(pageObj.speed);
  generate_feat_info(['args__'+featid],['overlap_box']);
 
}

function update_hsp_info (featid) {
 hide_big_picture();
 show_hsp_div();
 loading('image_info','Information');
 loading('query_image','Image');
 loading('subject_image','Image');
 get_hsp_info(['args__blastfile','args__'+pageObj.basename,'args__num','args__'+featid],['image_info','query_image','subject_image']);
}

function loading(id,msg) {
  var message = '<font class="loading">Loading '+msg+' . . .</font>';
  $('#'+id).html(message);
}

function show_hsp_div() {
  if( $('#result_visual').is(':hidden') == true) $('#result_visual').show(0);
}

function add_to_list(id,org){
  if (!id && !org) {return;}
  var check = $('#'+id).val();
  if (check){
//   alert('You have already added '+org+'.');
   return;
  }
  var html = '<option id='+id+' value='+id+' ondblclick="remove_selected_orgs();">'+org+'</option>';
  $('#blank').remove();
  $('#db_choice').append(html).sortSelect();
  counting();
}

function counting(){
  var count = $('#db_choice').getLength();
  if (count == 0) {$('#db_choice').html('<option id=blank value=null>No Database Selected</option>');}
  $('.count').html('Organism count: '+count);
}

function fill_nearby_feats(id,update) {
 get_nearby_feats(['args__basefile','args__'+pageObj.basename,'args__num','args__'+id],[update_checkbox]);
 if(update == "true") {update_sorting_table();}
} 

function click_all_feat_links(){
  var link_str = pageObj.featlinks;
  var link_array = new Array();
  link_array = link_str.split(',');
  for (var i = 0;i < link_array.length;i++)
  {
  	var val = link_array[i];
  	if (!val) {continue;}
  	fill_nearby_feats(link_array[i]);
  }
  update_sorting_table();
 }
 
function update_sorting_table() {
  if (ajax.length)
   {
    setTimeout("update_sorting_table()",100);
    return;
   }
  $("#hsp_result_table").trigger("update");
}

function update_checkbox(name, dist, hspid, id){
  
  $('#feat'+hspid).html(name);
  $('#dist'+hspid).html(dist);
  	var id_array = new Array();
	if (id)
	 {
  	id_array = id.split(',');
  	$('#checkbox'+id_array[0]).attr("id","checkbox"+id_array[1]);
  	$('#'+id_array[0]).attr("value",id_array[1]).attr("id",id_array[1]);
         }
}  

function overlap_checkboxes() {
  var action = $('#overlap_action').val();
  var accn = $('#feature_list').getCheckboxes();
  if (accn == ",") {
    alert("You have not checked any features.");
    return;
  }
  if(action == "gevo") {
    overlap_feats_parse(['args__'+accn],[send_to_gevo]);
  }
  else if (action == "fasta"){
    export_fasta_file(['args__'+accn,'args__'+pageObj.basename],[export_file]);
  }
  else if (action == "xls"){
    export_to_excel(['args__'+accn,'args__'+pageObj.basename],[export_file]);
  }
  else if(action == "tab"){
    generate_tab_deliminated(['args__'+accn,'args__'+pageObj.basename],[export_file]);
  }
  else if(action == "list"){
    generate_feat_list(['args__'+accn,'args__'+pageObj.basename],[export_file]);
  }
   else if(action == "hsp"){
    export_hsp_info(['args__'+accn,'args__'+pageObj.basename],[export_file]);
  }
  else {
    alert("We will get this working ... soon.");
  }
}

function get_all_hsp_data() {
	export_hsp_info(['args__all','args__'+pageObj.basename],[export_file]);
}

function get_query_fasta() {
	export_hsp_query_fasta(['args__'+pageObj.basename],[export_file]);
}

function get_subject_fasta(val) {
  if (val)
   {
    export_hsp_subject_fasta(['args__'+pageObj.basename,'args__'+val],[export_file]);
   }
  else
   {
    export_hsp_subject_fasta(['args__'+pageObj.basename],[export_file]);
   }
   
}

function get_alignment_file() {
	export_alignment_file(['args__'+pageObj.basename],[export_file]);
}

//This function might be redundant, considering the send_to_gevo function. Consider eliminating / consolidating the functions
function export_file(dir) {
  window.open(dir);
}

function send_to_gevo(url,num_accns) {
  if (url == "alert") {
    var remove = num_accns - 10;
    alert("You have exceeded the number of features you can send to GEvo ( 10 Max ). You currently have "+num_accns+" selected. Please uncheck "+remove+" of your checked item(s).");
  }
  else {
    window.open(url);
  }
}

jQuery.fn.getCheckboxes = function()
{
	var str = ",";
	this.each(
			function()
			{
				jQuery("input[@type=checkbox]",this).each(
					function() {
					  //alert(this.value);
					  if (this.checked == true) str = str + this.value +",";
					}
				);
			}
		);
	return str;
};

jQuery.fn.checkCheckboxes = function()
{
	//var returnWhat = jQuery([]);
	this.each(
		function()
		{
			jQuery("input[@type=checkbox]", this).each(
				function()
				{
					this.checked = true;
				}
			);
			//returnWhat = checked;
		}
	);
	//returnWhat = this;
};


jQuery.fn.unCheckCheckboxes = function()
{
	//var returnWhat = jQuery([]);
	this.each(
		function()
		{
			jQuery("input[@type=checkbox]", this).each(
				function()
				{
					this.checked = false;
				}
			).filter(":not(:checked)");
		}
	);
};

jQuery.fn.selectOptions = function(index) {
  this.each(
  	function() {
  		var opts = this.options;
  		opts[index].selected = true;
  	}	
  );	
  return this;
};


function enlarge_picture_window(id) {
  var window_width = $(window).width();
  var image_width = pageObj.image_width || 800;
  var left_padding;
  if ((window_width - image_width) <= 0) {
    left_padding = 4;
  }
  else {
    left_padding = ((window_width - image_width)/2);
  }
  var html = "<a href='#' onClick=\"$('#big_picture').slideToggle(pageObj.speed);\" style='float: right;'><img src='/CoGe/picts/delete.png' width='16' height='16' border='0'></a>";
  html = html + $('#large_db'+id).html();
  html = html+'<br>'+$('#large_pic'+id).html();
  $('#big_picture').html(html).css("left",''+left_padding).width(image_width).slideDown(pageObj.speed);
}


//TODO - clean this function up a bit
function show_seq(seq,name,num,dsid,chr,start,stop, rc) {
  if (num == 1) which_seq = "Query";
  else if (num == 2) which_seq = "Subject";
  else which_seq = "Alignment";
  if (seqObj){
    if (dsid == "seqObj") dsid = seqObj.dsid;
    if (chr == "seqObj") chr = seqObj.chr;
  } 
  var html = "<a href='#' onClick=\"$('#sequence_popup').slideToggle(pageObj.speed);\" style='float: right;'><img src='/CoGe/picts/delete.png' width='16' height='16' border='0'></a>";
  html = html + "<TABLE width=100%><TR><TD valign='top' align='right'>"+which_seq+" Name: </TD><TD align=justify>"+name+"</TD></TR>";
  
  //*1 to make sure js sees integer
  if (stop*1 > start*1) { 
    html = html + "<TR><TD valign='top' align='right'>"+which_seq+" Position: </TD><TD align=justify><pre>"+start+"-"+stop+"</pre></TD></TR>";
  }
  
  html = html + "<TR><TD valign='top' align='right'>"+which_seq+" Sequence: </TD><TD align=justify>"+seq+"</TD></TR></TABLE>";
  
  //check to see if SeqView is an option, then display link
  var regex = /^\d+$/;
  if (regex.test(dsid) && dsid != 0 && which_seq == "Subject") {
    html = html + "<br><a target='_blank' href='/CoGe/SeqView.pl?dsid="+dsid+"&chr="+chr+"&start="+start+"&stop="+stop+"&rc="+rc+">Click to view sequence in SeqView</a>";
  }
  var window_width = $(document).width();
  var left_padding;
  var info_width = 800;
  if ((window_width - info_width) <= 0) {
    left_padding = 4;
  }
  else {
    left_padding = ((window_width - info_width)/2);
  }
  $('#sequence_popup').html(html).css("left",''+left_padding).width(info_width).slideDown(pageObj.speed);
  if ($('#sequence_popup').height() >= $(document).height() - 40) {
    $('#sequence_popup').css("height",''+$(document).height() - 40);
  }
}

function get_params(){
 radio = get_radio("coge_radio","coge");
 var word_size = $('#word_size').val();
 var expect = $('#e_value').val();
 var match_mismatch = $('#match_score').val();
 var matrix = $('#matrix').val();
 var program = $('#'+radio).val();
 
 var gapcost;
 if (program == "blastn")
  { 
    var num1 = match_mismatch.substr(0,1);
    var num2 = match_mismatch.substr(2);
    gapcost = $('#gapcosts_'+num1+num2).val();
  }
 else
  {
    gapcost = $('#gapcosts_'+matrix).val();
  }

  var filter_query = 0;
  if ($('#filter_query')[0].checked) {filter_query=1;}
  var reslimit = $('#resultslimit').val();
//blastz parameters
 var zwordsize = $('#blastz_wordsize').val();
 var zgap_start = $('#blastz_gap_start').val();
 var zgap_extension = $('#blastz_gap_extension').val();
 var zchaining = $('#blastz_chaining').val();
 var zthreshold = $('#blastz_threshold').val();
 var zmask = $('#blastz_mask').val();
 
 var comp = $('#comp_adj').val();
 var seq = $('#seq_box').val();
 return {w : word_size, e : expect,g : gapcost,p : program,mm: match_mismatch,m : matrix,c : comp,s : seq, zw : zwordsize, zgs : zgap_start, zge : zgap_extension, zc : zchaining, zt : zthreshold, zm : zmask, fq : filter_query, rl : reslimit};
}

function get_ncbi_params(){
 radio = get_radio("ncbi_radio","ncbi");
 var word_size = $('#ncbi_word_size').val();
 var expect = $('#ncbi_e_value').val();
 var db = $('#ncbi_db').val();
 var match_mismatch = $('#ncbi_match_score').val();
 if (match_mismatch)
  {
    var num1 = match_mismatch.substr(0,1);
    var num2 = match_mismatch.substr(2);
  }
 var gapcost = $('#ncbi_gapcosts_'+num1+num2).val();
 var job_title = $('#job_title').val();
 var program = $('#'+radio).val();

 var matrix = $('#ncbi_matrix').val();
 var comp = $('#ncbi_comp_adj').val();
 var seq = $('#seq_box').val();
 
 return {w : word_size, e : expect, db : db,g : gapcost,j : job_title,p : program,mm: match_mismatch,m : matrix,c : comp,s : seq};
}

function update_basename(basename){
	pageObj.basename=basename;
	//alert(pageObj.basename);
}

function reset_basename(){
	if(pageObj.basename) pageObj.basename=0;
}

function blastOff(){
  if(!pageObj.basename) 
  {
  	setTimeout("blastOff()", 100);
  	return;
  }
  pageObj.waittime=1000;
  //alert("Passed setTimeout loop");
  var check = $('#db_choice').getLength();
  if(($('#blank').val())||(check==0)){
    alert('You have not selected any databases to blast. You must select at least one.');
    $('#coge_blast').slideDown(pageObj.speed);
    return;
  }

  var params = get_params();

  //$('.bresults').slideToggle(pageObj.speed);
  $('#blast_results').html('');
  //$('#blast_results').html('<font class="loading dna">Running BLAST Search . . .</font>');
  $('#log_text').html('').show(0);
  pageObj.nolog=1;
  setTimeout("monitor_log()", 1000);

  program = params.p;
  expect = params.e;
  job_title = params.j;
  word_size = params.w;
  comp = params.c;
  matrix = params.m
  match_score = params.mm;
  gapcost = params.g;
  seq = params.s;
  seq = seq.replace(/__/g,/_/);
  filter_query = params.fq;
  resultslimit = params.rl;
//blastz params
 var zwordsize = params.zw;
 var zgap_start = params.zgs;
 var zgap_extension = params.zge;
 var zchaining = params.zc;
 var zthreshold = params.zt;
 var zmask = params.zm;

  var page_width = ($('#co').width())*(95/100);
  pageObj.image_width = page_width;
  var blastable_db = $('#db_choice').getLength(1);
  //alert(pageObj.basename);
  blast_search([
  'args__program','args__'+program,
  'args__expect','args__'+expect,
  'args__job_title','args__'+job_title,
  'args__wordsize','args__'+word_size,
  'args__comp','args__'+comp,
  'args__matrix','args__'+matrix,
  'args__matchscore','args__'+match_score,
  'args__gapcost','args__'+gapcost,
  'args__filter_query','args__'+filter_query,
  'args__resultslimit','args__'+resultslimit,

  'args__zwordsize','args__'+zwordsize,
  'args__zgap_start','args__'+zgap_start,
  'args__zgap_extension','args__'+zgap_extension,
  'args__zchaining','args__'+zchaining,
  'args__zthreshold','args__'+zthreshold,
  'args__zmask','args__'+zmask,

  'args__basename','args__'+pageObj.basename,

  'args__seq','args__'+seq,
  'args__blastable','args__'+blastable_db,
  'args__width','args__'+page_width,
  'args__color_hsps', 'color_by',
  ],[blastresults],'POST');
  
}
 
function blastresults(html, click_all_links){
  $('#log_text').hide(0);
  pageObj.featlinks = click_all_links;
  $('#blast_results').html(html);
  if($('#null').html() == "null") {
    $('#result_features').hide();
    return;
  }
  else {
  var table_height = $('#hsp_result_table_body').height();
  var max_height = 300;
  if (table_height > max_height) $('#hsp_result_table_body').height(max_height);
  init_table();
 }
}

function init_table () {

$.tablesorter.addParser({
 id: 'percent',
 is: function(s) {return false;},
 format: function(s) {return s.replace(/%/,'');},
 type: 'numeric'
});

$(function(){
 $("#hsp_result_table").tablesorter({		
// 		sortColumn: 'HSP#',			// Integer or String of the name of the column to sort by.
		sortClassAsc: 'headerSortUp',		// Class name for ascending sorting action to header
		sortClassDesc: 'headerSortDown',	// Class name for descending sorting action to header
		headerClass: 'header',			// Class name for headers (th's)
		widgets: ['zebra'],
		textExtraction: 'complex',
		headers: {0: {sorter: false},
		          7: {sorter: 'percent'},
		          9: {sorter: 'percent'},
		          11: {sorter: 'percent'}
			 },					
		sortList: [[2,0],[5,0]],
		});
 });
}


function ncbi_blast(url) {
 if (url == 1)
  {alert('You have not selected a BLAST program! Please select a program to run.');}
 else {
   var params = get_ncbi_params();
   seq = params.s;
   seq = seq.replace(/\n/,'%0D');
   db = params.db;
   expect = params.e;
   job_title = params.j;
   word_size = params.w;
   comp = params.c;
   matrix = params.m
   match_score = params.mm;
 
   url = url+'&DATABASE='+db+'&EXPECT='+expect+'&QUERY='+seq+'&JOB_TITLE='+job_title+'&WORD_SIZE='+word_size;
 
   if (program == 'blastn') {
     window.open(url+'&MATCH_SCORES='+match_score);
   }

   else {
     if ($('#comp_adj').is(':hidden')) {window.open(url+'&MATRIX_NAME='+matrix);}
     else {window.open(url+'&MATRIX_NAME='+matrix+'&COMPOSITION_BASED_STATISTICS='+comp);}
   }
 }
}

function update_gapcost(pro) {
    $('.gapcosts').hide();
    if(pro)
    {
      var val = $('#matrix').val();
      $('#gapcosts_'+val).slideToggle(pageObj.speed);
    }
    else
    {
      var str = $('#match_score').val();
      var num1 = str.substr(0,1);
      var num2 = str.substr(2);
      $('#gapcosts_'+num1+num2).slideToggle(pageObj.speed);
    }
}

function update_gapcost_ncbi(pro) {
    $('.ncbi_gapcosts').hide();
    if(pro)
    {
      var val = $('#ncbi_matrix').val();
      $('#ncbi_gapcosts_'+val).slideToggle(pageObj.speed);
    }
    else
    {
      var str = $('#ncbi_match_score').val();
      var num1 = str.substr(0,1);
      var num2 = str.substr(2);
       $('#ncbi_gapcosts_'+num1+num2).slideToggle(pageObj.speed);
    }
}

$.fn.getLength = function(val){
  var opt_length;
  var blastable;
  this.each(
  	function()
  	{
  		var opts = this.options;
  		opt_length = opts.length;
  		if (opt_length == 0) {return opt_length;}
  		blastable = opts[0].id;
  		if (val){
  		  for(var i=1;i<opts.length;i++)
	  	  {
	  		blastable += ","+opts[i].id;
	  		//need to chopoff last comma
	  	  }
  		}
  	}
  );
  if(val) return blastable;
  else return opt_length;
};

$.fn.sortSelect = function(){
  this.each(
	  function()
	  {
	  	if(this.nodeName.toLowerCase() != "select"){
	  	  return;}
	  	var opts = this.options;
	  	var sortArray = [];
	  	for(var i=0;i<opts.length;i++)
	  	{
	  		sortArray[i] = {
	  				v: opts[i].value,
	  				t: opts[i].text,
	  				d: opts[i].id,
	  				}
	  	}
	  	sortArray.sort(
	  			function(obj1,obj2)
	  			{
	  				obj1t = obj1.t.toLowerCase(),
	  				obj2t = obj2.t.toLowerCase();
	  				if(obj1t == obj2t){
	  				  return 0;}
	  				return obj1t < obj2t ? -1 : 1;
	  			}
	  	);
	  	for(var i=0;i<opts.length;i++)
	  	{
	  		opts[i].id = sortArray[i].d;
	  		opts[i].text = sortArray[i].t;
	  		opts[i].value = sortArray[i].v;
	  	}
	  }
	);
	return this;
};

function display_correct_radio(display,val) {
  if (display == false) {
    $("#"+val+"_select_n").hide(0);
    $("#"+val+"_select_p").slideDown(pageObj.speed);
  }
  else {
    $("#"+val+"_select_p").hide(0);
    $("#"+val+"_select_n").slideDown(pageObj.speed);
  }
}

function hide_big_picture() {
  if ($('#big_picture').is(':hidden') == false) $('#big_picture').slideToggle(pageObj.speed);
}

function select_blast() {
  var radio = get_radio('ncbi_radio','ncbi');
  get_url([radio],[ncbi_blast]);
}

function get_radio(which_type,val){
  var radio = $('#'+which_type)[0].checked;
  if (radio == true){
   radio = val+"_blast_type_n";}
  else{
   radio = val+"_blast_type_p";}
  return radio;
}

function get_seq(which_type) {
 dsid = seqObj.dsid;
 featid = seqObj.featid;
 chr = seqObj.chr;
 if (featid) {
   get_sequence([
	'args__fid','args__'+featid,
	'args__blast_type', which_type, 
	'args__upstream', 'args__'+seqObj.upstream,
	'args__downstream', 'args__'+seqObj.downstream,
	'args__rc','args__'+seqObj.rc
	],['seq_box']);
 }
 else if (chr) {
   get_sequence([
	'args__chr','args__'+chr,
   	'args__dsid','args__'+dsid,
	'args__blast_type', which_type, 
	'args__start', 'args__'+seqObj.upstream,
	'args__stop', 'args__'+seqObj.downstream
	],['seq_box']);
 }
 else {
  return;
 }
}

function blast_param_on_select(which_type,val) {
 radio = get_radio(which_type,val);
 program = $('#'+radio).val();
 database_param([radio],['database']);
 
 $('#blast_parameters').hide();
 $('#blastz_parameters').hide();

 if (program == 'blastz')
  {
  $('#blastz_parameters').slideDown(pageObj.speed);
  }
 else
 {
  $('#blast_parameters').slideDown(pageObj.speed);
  if ((program == 'blastx') || (program == 'tblastx')) {
   blast_param(['args__blast_type','args__'+"blast_type_p",'args__translate','args__1','args__version','args__'+which_type],[animate_params]);
   $('#word_size').val(3);
  }
  else if ((program == 'blastp') || (program == 'tblastn')) {
   blast_param(['args__blast_type','args__'+"blast_type_p",'args__version','args__'+which_type],[animate_params]);
   $('#word_size').val(3);
  }
  else {
   blast_param(['args__version','args__'+which_type],[animate_params]);
   $('#word_size').val(8);
  }
 }
}

function animate_params (html,version,pro){
  if(version == "coge_radio") {
      $('#pro_or_nu_param').hide(0).html(html).slideDown(pageObj.speed);
      update_gapcost(pro);
  }
  else{
      $('#ncbi_pro_or_nu_param').hide(0).html(html).slideDown(pageObj.speed);
      update_gapcost_ncbi(pro);
  }
}



function show_add() {
  if($('#add').is(":hidden")) {
    $('#remove').hide(0);
    $('#add').show(0);
  }
}

function clear_if_no_seq(){
  if($('#seq_box').val() == "Enter a fasta sequence here"){
    $('#seq_box').html('');
  }
}

function toggleFeature(html,check) {
 var size = $('#seq_box').width();
 if (html) {
   $('#pretty_print_anno').html(html).width(size).show(pageObj.speed);
 }
 else if (check) {
   $('#pretty_print_anno').width(size).show(pageObj.speed);
 }
 else {
  animate_section("#pretty_print_anno", "hide");
 }
}

function org_search(){
  if (pageObj.time){
   clearTimeout(pageObj.time);
  }

  pageObj.time = setTimeout("get_orgs(['args__name','org_name','args__desc','org_desc'], ['org_list']);",500);
//  get_orgs(['args__name','org_name','args__desc','org_desc'], ['org_list']);
  setTimeout("seq_type_search()",500);
}

function seq_type_search() {

 if (ajax.length)
    {
     setTimeout("seq_type_search()",500);
    }
  else if ($('#org_id').val()) {
    get_seq_types(['org_id'],['org_seq_types']);
    show_add();
   }
  else {
   $('#org_seq_types').html('');
   $('#add').hide(0);
  }
}

function search_bar(div_id){
  if($('#'+div_id).val() == "Search") $('#'+div_id).val("").css({fontStyle: "normal"});
}

function restore_search_bar(div_id){
  if($('#'+div_id).val() == "") {
  $('#'+div_id).val("Search").css({fontStyle: "italic"});
  get_orgs(['args__name','org_name','args__desc','org_desc'], ['org_list']);
 }
}

function clear_box(div_id) {
 $('#'+div_id).val("");
}

function org_info(info){
  var xpos = pageObj.lastMouseX + 5;
  var ypos =pageObj.lastMouseY + 5;
  var html = "<a href='#' onClick=\"$('#org_info_popup').slideToggle(pageObj.speed);\" style='float: right;'><img src='/CoGe/picts/delete.png' width='16' height='16' border='0'></a>";
  html = html + info;
  var window_width = $(document).width();
  var left_padding;
  var info_width = 800;
  if ((window_width - info_width) <= 0) {
    left_padding = 4;
  }
  else {
    left_padding = ((window_width - info_width)/2);
  }
  $('#org_info_popup').html(html).css({left:''+xpos,top:''+ypos}).width(info_width).slideDown(pageObj.speed);
  if ($('#org_info_popup').height() >= $(document).height() - 40) {
    $('#org_info_popup').css("height",''+$(document).height() - 40);
  }
}

function adjust_blast_types(val){
  if(val == 1){
    if($('#ncbi_blast_type').is(":hidden")){
      $('#coge_blast_type').hide(0);
      $('#ncbi_blast_type').show(0);
      get_seq('ncbi_radio');
    }
    else return;
  }
  else{
    if($('#coge_blast_type').is(":hidden")){
      $('#coge_blast_type').show(0);
      $('#ncbi_blast_type').hide(0);
      get_seq('coge_radio');
    }
    else return;
  }
}

function matrix_view (){
var matrix = $('#matrix').val();
window.open('/CoGe/MatrixView.pl?matrix='+matrix);
}

 function monitor_log(log)
{
  var fasta = 0;
  var blast = 0;
  var results = 0;
  var done = 0;
  var match;
  pageObj.finished = 0;
  if (log) {
  /*
 
   if (log.match(/Finished!/))
    {
     database = database+"done!\n";
     pageObj.finished = 1;
    }
   
   match=log.match(/fasta/i);
  if (match && match[0])
   { 
     match.reverse();  
     sequence = "Generating "+match[0]+". . .";
   }
   match=log.match(/running\s+(\(.*?\))/g);
   if (match && match[0]) {
     sequence = sequence +"done!<br/>";
     match.reverse();
     val = match[0];
     if (!val) val = "";
     algo = "Alignment algorithm "+val+". . .";
   }
  
   match=log.match(/image\s+(\(.*?\))/g);
   if (match && match[0]) {
     algo = algo+"done!<br/>";
     match.reverse();
     val = match[0];
     if (!val) val = "";
     image = "Rendering "+val+". . .";
   }
   if (log.match(/database/)) {
     image = image+"done!<br/>";
     database = "Generating annotation database. . .";
   }
  } 
  */
  //match=log.match(/\*\s+fasta\sfile/);
  if(log.match(/\*\s+fasta\sfile/i))
  {
  	fasta="Generating blastable databases . . . <br/>";
  	match=log.match(/\*(.+)\*\sblastdb/g);
  	if(match)
  	{
  		var crappy_workaround;
  		for (i=0;i<match.length;i++)
  		{
  			crappy_workaround = match[i].match(/\*(.+)\*/);
  			fasta += "&nbsp;&nbsp;&nbsp;"+crappy_workaround[1]+" database built!<br/>";
  		}
  	}
  }
  
    if(log.match(/running/i))
  {
  	fasta += "Blastable databases generation done!<br/>";
  	var blast_program = log.match(/-p\s(\w+)\s/);
	if (!blast_program)
	  {
	    blast_program = log.match(/(blastz)/);
	  }
  	blast="Running "+blast_program[1]+" algorithm . . . <br/>";
  	
  	match=log.match(/\*(.+)\*\sblast\sanalysis\scomplete/g);
  	if(match)
  	{
  		var crappy_workaround;
  		for (i=0;i<match.length;i++)
  		{
  			crappy_workaround = match[i].match(/\*(.+)\*/);
  			blast += "&nbsp;&nbsp;&nbsp;"+crappy_workaround[1]+" complete!<br/>";
  		}
  	}
  }
  
  if(log.match(/Results/i))
  {
  	blast += "Analysis complete!<br/>";
  	results = "Collecting resultings . . . ";
  }
     if (log.match(/Finished/i))
    {
     results += "done!<br/>";
     done = "Displaying results . . ."
     
     pageObj.finished = 1;
    }
    
  }
  
  else {pageObj.nolog += 1;}
  var message = "Initializing search . . . ";
  
  if (fasta) message += "done!<br/>"+fasta;
  if (blast) message += blast;
  if (results) message += results;
  if (done) message += done;
  
/*  if (!pageObj.finished && pageObj.nolog<8) {
  setTimeout("read_log(['args__logfile', 'args__'+pageObj.basename, 'args__prog','args__CoGeBlast'], [monitor_log])",1000);
  }
*/
//  if (ajax.length) {setTimeout("read_log(['args__logfile', 'args__'+pageObj.basename, 'args__prog','args__GEvo'], [monitor_log])",1000);}
  if (!pageObj.finished && pageObj.nolog<8)
  {
    var waittime = pageObj.waittime;
    pageObj.waittime = pageObj.waittime*2;
    message+="<br/>Next progress check in "+waittime/1000+" seconds.";
    setTimeout("read_log(['args__logfile', 'args__'+pageObj.basename, 'args__prog','args__CoGeBlast'], [monitor_log])",waittime);
  }
/*
  else
  {
   message = "There has been no update on your results during the first "+pageObj.waittime/1000+ "seconds of your analysis.  An error may have occured.  You can check your logfile at <a href='tmp/GEvo/"+pageObj.basename+".log' target=_new>this link</a> which may help you determin what went wrong, or send it to CoGe's adminstrator for debugging.  In the meanwhile, we suggest that you either wait a bit longer to see if the analsysi completes, and if not rerun your analysis.  If you have submitting very large regions for anlaysis (e.g. several megabases), please try a smaller region for analsyis.";
  }
  */
  if (message) $('#log_text').html("<div class='small'>"+message+'</div>');
}


function clear_org_list()
 {
 $('#db_choice').empty();
 counting();
 }


function remove_selected_orgs() {
 $('#db_choice option:selected').each(function(){
    $('#'+$(this).val()).remove();
    });
 counting();

 }
 
function add_all_orgs() {
 $('#org_id option').each(function(){
    get_from_id(['args__'+$(this).val()],[add_to_list])
    });
}

function add_selected_orgs() {
 $('#org_id option:selected').each(function(){
    get_from_id(['args__'+$(this).val()],[add_to_list])
    });
}



</SCRIPT>
</TMPL_IF>

<TMPL_IF NAME="BLAST_FRONT_PAGE">
<div id=big_picture title="Enlarged Image of HSP Hits" class="image_window" style="display:none;"></div>
<div id="sequence_popup" class="image_window" style="display:none;overflow: auto;max-height: 300px;"></div>
<div id="org_info_popup" class="image_window" style="display:none;overflow: auto;max-height: 300px;"></div>

<TABLE width=100%>
 <TR>
  <TD>
  <div id=tab>
   <ul class="ui-tabs-nav">
     <li class="ui-tabs-selected">
       <a href="#cogeblast_option" onclick="adjust_blast_types()">
        <span>Use CoGe Blast</span>
       </a>
      </li>
      <li class="ui-tabs-selected">
       <a href="#ncbiblast_option" onclick="adjust_blast_types(1)">
        <span>Use NCBI Blast</span>
       </a>
      </li>
     </ul>
    </div>
  </TD>
 </TR>
 <TR>
  <TH colspan="3">
  <div id="cogeblast_option">
  <a href="#" id="coge_blast_button" onClick="reset_basename();generate_basefile([],[update_basename]);blastOff();"><span>CoGe BLAST</span></a><br>
   <DIV id = "co" name="slider" class="topItem">CoGe BLAST Options:</DIV>
   <DIV class="dropMenu" id="query_seqs">
   <TABLE class="list" >
       <TR valign=top>
          <TD>
   	<DIV id="blah">Organism Name: <input type="text" size=11 onFocus="search_bar('org_name');clear_box('org_desc');restore_search_bar('org_desc');" style="font-style:italic" value="Search" name="org_name" id="org_name" onBlur="restore_search_bar('org_name')" onKeyUp='org_search();'></DIV>
   	<DIV id="blah">Organism Description: <input type="text" size=11 onFocus="search_bar('org_desc');clear_box('org_name');restore_search_bar('org_name');" style="font-style:italic" value="Search" name="org_desc" id="org_desc" onBlur="restore_search_bar('org_desc')" onKeyUp='org_search();'></DIV>
   	<DIV id="org_list"><TMPL_VAR NAME="ORG_LIST"></DIV>
   	<DIV id="org_seq_types"><TMPL_VAR NAME="ORG_SEQ_TYPES"></DIV>
   	<input type=button value="Get Org Info" onClick="org_info('<span class=loading>Loading. . .</span>');dataset_description_for_org(['org_id', 'seq_type_id'],[org_info]);pageObj.lastMouseX=event.pageX;pageObj.lastMouseY=event.pageY;">
   	<input type=button value="Add all" onClick="add_all_orgs();">
   	  </TD>
   	  <TD valign="middle" align=middle>
<!--	  <input type="button" style="display: none" id=remove value="&larr; Remove" onClick="$('#'+$('#db_choice').val()).remove();counting();"> -->
	  <input type="button" style="display: none" id=remove value="&larr; Remove" onClick="remove_selected_orgs();">
   	  <input type="button" style="display: none" id=add value="Add &rarr;  " onClick="add_selected_orgs();">
   	  </TD>
           <TD>
              <div id=db_title>Organism Database(s) to BLAST:</DIV>
              <font class="small count">Database count: 0</font>
              <DIV id=db_select><SELECT id="db_choice" SIZE="8" MULTIPLE onClick="$('#add').hide(0);$('#remove').show(0);">
              <option id=blank value=null>No Database Selected</option>
              </SELECT></DIV>
              <TMPL_IF NAME="SAVE_ORG_LIST">
	      <input type=button value="Save Org List" name="SaveSettings" id="SaveSettings" onclick="save_settings_cogeblast(['args__orgids','args__'+$('#db_choice').getLength(1), 'args__resultslimit','resultslimit'],[])">
              </TMPL_IF>
	      <input type=button value="Clear Org List" name="clearlist" id="clearlist" onclick="clear_org_list();">
           </TD>
     <td width="1" bgcolor="#99ff99"/>
     <TD valign="top">
      <TH align=left valign="top"> <u>Blast Parameters</u><br>
      <DIV id=blast_parameters>
      <TABLE>
       <TR>
	<TD>
	  E-Value:
	</TD>
	<TD>
	    <select name=e_value id=e_value>
             <option value = ".000001"> 1e-6
	     <option value = ".00001"> 1e-5
	     <option value = ".0001"> 0.0001
             <option value = ".001" selected> 0.001
             <option value = ".01"> 0.01
             <option value = ".1"> 0.1
	     <option value = "1"> 1
	     <option value = "10"> 10
             <option value = "100"> 100
            </select>
       </TR>
       <TR>
	<TD>
	   Word size:
	</TD>
	<TD>
	 <input type=text id=word_size value="7" size="7">
       </TR>
       <TR>
	<TD>
	  Gap Costs:
       </TD>
	<TD>
	  <select id="gapcosts_1-2" class="gapcosts" style="display: block">
<!--	  	<option value = "0 0"  >Linear</option>   -->
		<option value = "5 2"  selected>Existence:  5 Extension: 2</option>				
		<option value = "2 2"  >Existence:  2 Extension: 2</option>				
		<option value = "1 2"  >Existence:  1 Extension: 2</option>
		<option value = "0 2"  >Existence:  0 Extension: 2</option>
		<option value = "3 1"  >Existence:  3 Extension: 1</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>				
	</select>
	<select id="gapcosts_1-3" class="gapcosts" style="display: none">
<!--		<option value = "0 0" >Linear</option>    -->
		<option value = "5 2" >Existence:  5 Extension: 2</option>				
		<option value = "2 2"  >Existence:  2 Extension: 2</option>		
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>	
	</select>

	<select id="gapcosts_1-4" class="gapcosts" style="display: none">
<!--		<option value = "0 0" >Linear</option>    -->
		<option value = "5 2" >Existence:  5 Extension: 2</option>					
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>	
	</select>
	<select id="gapcosts_2-3" class="gapcosts" style="display: none">
<!--		<option value = "0 0" >Linear</option>    -->
		<option value = "4 4"  >Existence:  4 Extension: 4</option>		
		<option value = "2 4"  >Existence:  2 Extension: 4</option>		
		<option value = "0 4"  >Existence:  0 Extension: 4</option>		
		<option value = "3 3"  >Existence:  3 Extension: 3</option>		
		<option value = "6 2"  >Existence:  6 Extension: 2</option>		
		<option value = "5 2" >Existence:  5 Extension: 2</option>		
		<option value = "4 2"  >Existence: 4 Extension: 2</option>		
		<option value = "2 2"  >Existence:  2 Extension: 2</option>				
	</select>
	<select id="gapcosts_4-5" class="gapcosts" style="display: none">
<!--		<option value = "0 0" >Linear</option>   -->
		<option value = "12 8" >Existence:  12 Extension: 8</option>		
		<option value = "6 5"  >Existence:  6 Extension: 5</option>		
		<option value = "5 5"  >Existence:  5 Extension: 5</option>		
		<option value = "4 5"  >Existence:  4 Extension: 5</option>		
		<option value = "3 5"  >Existence:  3 Extension: 5</option>	
	</select>
	<select id="gapcosts_1-1" class="gapcosts" style="display: none">
		<option value = "5 2"  >Existence:  5 Extension: 2</option>							
		<option value = "3 2"  >Existence:  3 Extension: 2</option>		
		<option value = "2 2"  >Existence:  2 Extension: 2</option>		
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "4 1"  >Existence:  4 Extension: 1</option>		
		<option value = "3 1"  >Existence:  3 Extension: 1</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>
	</select>
	<select id="gapcosts_BLOSUM62" class="gapcosts" style="display: none">
		<option value = "9 2"   >Existence:  9 Extension: 2</option>	
		<option value = "8 2"   >Existence:  8 Extension: 2</option>	
		<option value = "7 2"   >Existence:  7 Extension: 2</option>	
		<option value = "12 1"  >Existence: 12 Extension: 1</option>	
		<option value = "11 1" selected >Existence: 11 Extension: 1</option>	
		<option value = "10 1"  >Existence: 10 Extension: 1</option>		
	</select>
	<select id="gapcosts_PAM30" class="gapcosts" style="display: none">
		<option value = "7 2"  >Existence:  7 Extension: 2</option>			
		<option value = "6 2"  >Existence:  6 Extension: 2</option>		
		<option value = "5 2"  >Existence:  5 Extension: 2</option>		
		<option value = "10 1" >Existence: 10 Extension: 1</option>		
		<option value = "9 1"  selected>Existence: 9 Extension: 1</option>		
		<option value = "8 1"  >Existence: 8 Extension: 1</option>
	</select>
	<select id="gapcosts_PAM70" class="gapcosts" style="display: none">
		<option value = "8 2"  >Existence:  8 Extension: 2</option>	
		<option value = "7 2"  >Existence:  7 Extension: 2</option>			
		<option value = "6 2"  >Existence:  6 Extension: 2</option>			
		<option value = "11 1" >Existence: 11 Extension: 1</option>	
		<option value = "10 1" selected>Existence: 10 Extension: 1</option>		
		<option value = "9 1"  >Existence: 9 Extension: 1</option>
	</select>
	<select id="gapcosts_BLOSUM80" class="gapcosts" style="display: none">
		<option value = "8 2"   >Existence:  8 Extension: 2</option>	
		<option value = "7 2"   >Existence:  7 Extension: 2</option>			
		<option value = "6 2"   >Existence:  6 Extension: 2</option>			
		<option value = "11 1"   >Existence: 11 Extension: 1</option>	
		<option value = "10 1"   selected>Existence: 10 Extension: 1</option>		
		<option value = "9 1"   >Existence: 9 Extension: 1</option>		
	</select>
	<select id="gapcosts_BLOSUM45" class="gapcosts" style="display: none">
		<option value = "13 3"   >Existence: 13 Extension: 3</option>	
		<option value = "12 3"   >Existence: 12 Extension: 3</option>	
		<option value = "11 3"   >Existence: 11 Extension: 3</option>	
		<option value = "10 3"   >Existence: 10 Extension: 3</option>	
		<option value = "15 2"  selected >Existence: 15 Extension: 2</option>	
		<option value = "14 2"   >Existence: 14 Extension: 2</option>	
		<option value = "13 2"   >Existence: 13 Extension: 2</option>	
		<option value = "12 2"   >Existence: 12 Extension: 2</option>	
		<option value = "19 1"   >Existence: 19 Extension: 1</option>	
		<option value = "18 1"   >Existence: 18 Extension: 1</option>	
		<option value = "17 1"   >Existence: 17 Extension: 1</option>	
		<option value = "16 1"   >Existence: 16 Extension: 1</option>		
	</select>
	
	  </td>
	 </tr>
	 <TR> 
	  <td>Filter query sequence:
	  <td><label><input class="backbox" type="radio" name="filter_query" id="filter_query" value="T"  checked />Yes</label><label><input class="backbox" type="radio" name="filter_query" id="filter_query" value="F"/>No</label>
	<TR>
	  <td> Limit results to:
	  <td><input type=text id="resultslimit" value="<TMPL_VAR NAME="RESULTSLIMIT">" size="5"> per organism
      </TABLE>

      <DIV id=pro_or_nu_param></DIV>
     </div>
     <DIV id=blastz_parameters>
<table>
   <TR>
  <TD>Word size: </TD>
  <TD><input class="backbox" type="text" name="blastz_wordsize" id="blastz_wordsize" tabindex="1" size="4" value="8" /></TD>
 </TR>    
<TR>
  <TD>Gap start penality: </TD>
  <TD><input class="backbox" type="text" name="blastz_gap_start" id="blastz_gap_start" tabindex="1" size="4" value="400" /></TD>
 </TR>    
 <TR>
  <TD>Gap extend penality: </TD>
  <TD><input class="backbox" type="text" name="blastz_gap_extension" id="blastz_gap_extension" tabindex="1" size="4" value="30" /></TD>
 </TR>    
 <TR>
  <TD>Chaining: </TD>
  <TD><select class="backbox" id="blastz_chaining" tabindex="1" />
      <option value=0>no chaining</option>
      <option value=1>just output chain</option>
      <option value=2>chain and extend</option>
      <option value=3>just output HSPs</option>
      </select></TD>
 </TR>    
 <TR>
  <TD>Score threshold: </TD>
  <TD><input class="backbox" type="text" name="blastz_threshold" id="blastz_threshold" tabindex="1" size="4" value="3000" /></TD>
 </TR>    
 <TR>
  <TD>Mask threshold: </TD>
  <TD><input class="backbox" type="text" name="blastz_mask" id="blastz_mask" tabindex="1" size="4" value="0" /></TD>
 </TR>    


<!--  <TR>
  <TD>Other Blastz parameters: </TD>
  <TD><input class="backbox" type="text" name="blastz_params" id="blastz_params" tabindex="1" size="10" /></TD>
 </TR>-->

</table>

     </div>
     </TD>
          </TR>
         </TABLE>
</DIV>
 </DIV>
  </div>
   <div id="ncbiblast_option" style="display:none">
   <a href="#" id="ncbi_blast_button" onClick="select_blast()"><span>NCBI BLAST</span></a><br>
   <DIV class="ncbiblast_opts">
   <DIV id = "ncbio" name="slider" class="topItem" onMouseOver="$('#ncbio').removeClass('topItem').addClass('topItemSelected');" onMouseOut="$('#ncbio').removeClass('topItemSelected').addClass('topItem');" onClick='animate_section("#ncbi_blast_opts", "slideToggle")'>NCBI BLAST Options:</DIV>
   <DIV class="dropMenu" id="ncbi_blast_opts">
   <TABLE width=100% id=stuff>
    <TR>
     <TD valign="top">
      <TH align=left valign="top"><u>BLAST Parameters</u><br>
      <TABLE>
       <TR>
	<TD>
	 Job Title
	</TD>
	<TD> 
	 <input id=job_title type=text value="<TMPL_VAR NAME=USER_NAME>'s BLAST">
	</TD>
       </TR>
       <TR>
        <TD>
	  Database
	</TD>
	<TD>
	<DIV id=database></DIV>
       </TR>
       <TR>
	<TD>
	  Filter
 	</TD>
	<TD>
	     <select name=complexity id=complexity>
              <option value = "0"> Off
	      <option value = "L"> Low Complexity
              <option value = "R"> Human Repeats
              <option value = "m"> Mask for Lookup
             </select>
       </TR>
      </TABLE>
     </TD>
     <td width="1" bgcolor="#99ff99"/>
     <TD valign="top">
      <TH align=left valign="top"> <u>BLAST Scoring</u><br>
      <TABLE>
       <TR>
	<TD>
	  E-Value
	</TD>
	<TD>
	    <select name=ncbi_e_value id=ncbi_e_value>
             <option value = ".000001"> 1e-6
	     <option value = ".00001"> 1e-5
	     <option value = ".0001" selected> 0.0001
             <option value = ".001"> 0.001
             <option value = ".01"> 0.01
             <option value = ".1"> 0.1
	     <option value = "1"> 1
	     <option value = "10"> 10
             <option value = "100"> 100
            </select>
       </TR>
       <TR>
	<TD>
	   Word size
	</TD>
	<TD>
	 	 <select name=ncbi_word_size id=ncbi_word_size>
           <option value = "16"> 16
	       <option value = "20"> 20
	       <option value = "24"> 24
           <option value = "28" selected> 28
           <option value = "32"> 32
           <option value = "48"> 48
	       <option value = "64"> 64
         </select>
       </TR>
       <TR>
	<TD>
	  Gap Costs:
       </TD>
	<TD>
	  <select id="ncbi_gapcosts_1-2" class="ncbi_gapcosts" style="display: block">
	  	<option value = "0 0"  >Linear</option>   
		<option value = "5 2"  >Existence:  5 Extension: 2</option>				
		<option value = "2 2"  >Existence:  2 Extension: 2</option>				
		<option value = "1 2"  >Existence:  1 Extension: 2</option>
		<option value = "0 2"  >Existence:  0 Extension: 2</option>
		<option value = "3 1"  >Existence:  3 Extension: 1</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>				
	</select>
	<select id="ncbi_gapcosts_1-3" class="ncbi_gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "5 2" >Existence:  5 Extension: 2</option>				
		<option value = "2 2"  >Existence:  2 Extension: 2</option>		
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>	
	</select>

	<select id="ncbi_gapcosts_1-4" class="ncbi_gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "5 2" >Existence:  5 Extension: 2</option>					
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>		
		<option value = "1 1"  >Existence: 1 Extension: 1</option>	
	</select>
	<select id="ncbi_gapcosts_2-3" class="ncbi_gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "4 4"  >Existence:  4 Extension: 4</option>		
		<option value = "2 4"  >Existence:  2 Extension: 4</option>		
		<option value = "0 4"  >Existence:  0 Extension: 4</option>		
		<option value = "3 3"  >Existence:  3 Extension: 3</option>		
		<option value = "6 2"  >Existence:  6 Extension: 2</option>		
		<option value = "5 2" >Existence:  5 Extension: 2</option>		
		<option value = "4 2"  >Existence: 4 Extension: 2</option>		
		<option value = "2 2"  >Existence:  2 Extension: 2</option>				
	</select>
	<select id="ncbi_gapcosts_4-5" class="ncbi_gapcosts" style="display: none">
		<option value = "0 0" >Linear</option>   
		<option value = "12 8" >Existence:  12 Extension: 8</option>		
		<option value = "6 5"  >Existence:  6 Extension: 5</option>		
		<option value = "5 5"  >Existence:  5 Extension: 5</option>		
		<option value = "4 5"  >Existence:  4 Extension: 5</option>		
		<option value = "3 5"  >Existence:  3 Extension: 5</option>	
	</select>
	<select id="ncbi_gapcosts_1-1" class="ncbi_gapcosts" style="display: none">
		<option value = "5 2"  >Existence:  5 Extension: 2</option>							
		<option value = "3 2"  >Existence:  3 Extension: 2</option>		
		<option value = "2 2"  >Existence:  2 Extension: 2</option>		
		<option value = "1 2"  >Existence:  1 Extension: 2</option>		
		<option value = "0 2"  >Existence:  0 Extension: 2</option>		
		<option value = "4 1"  >Existence:  4 Extension: 1</option>		
		<option value = "3 1"  >Existence:  3 Extension: 1</option>		
		<option value = "2 1"  >Existence:  2 Extension: 1</option>	
	</select>
	<select id="ncbi_gapcosts_BLOSUM62" class="ncbi_gapcosts" style="display: none">
		<option value = "9 2"   >Existence:  9 Extension: 2</option>	
		<option value = "8 2"   >Existence:  8 Extension: 2</option>	
		<option value = "7 2"   >Existence:  7 Extension: 2</option>	
		<option value = "12 1"  >Existence: 12 Extension: 1</option>	
		<option value = "11 1" selected >Existence: 11 Extension: 1</option>	
		<option value = "10 1"  >Existence: 10 Extension: 1</option>		
	</select>
	<select id="ncbi_gapcosts_PAM30" class="ncbi_gapcosts" style="display: none">
		<option value = "7 2"  >Existence:  7 Extension: 2</option>			
		<option value = "6 2"  >Existence:  6 Extension: 2</option>		
		<option value = "5 2"  >Existence:  5 Extension: 2</option>		
		<option value = "10 1" >Existence: 10 Extension: 1</option>		
		<option value = "9 1"  selected>Existence: 9 Extension: 1</option>		
		<option value = "8 1"  >Existence: 8 Extension: 1</option>
	</select>
	<select id="ncbi_gapcosts_PAM70" class="ncbi_gapcosts" style="display: none">
		<option value = "8 2"  >Existence:  8 Extension: 2</option>	
		<option value = "7 2"  >Existence:  7 Extension: 2</option>			
		<option value = "6 2"  >Existence:  6 Extension: 2</option>			
		<option value = "11 1" >Existence: 11 Extension: 1</option>	
		<option value = "10 1" selected>Existence: 10 Extension: 1</option>		
		<option value = "9 1"  >Existence: 9 Extension: 1</option>
	</select>
	<select id="ncbi_gapcosts_BLOSUM80" class="ncbi_gapcosts" style="display: none">
		<option value = "8 2"   >Existence:  8 Extension: 2</option>	
		<option value = "7 2"   >Existence:  7 Extension: 2</option>			
		<option value = "6 2"   >Existence:  6 Extension: 2</option>			
		<option value = "11 1"   >Existence: 11 Extension: 1</option>	
		<option value = "10 1"   selected>Existence: 10 Extension: 1</option>		
		<option value = "9 1"   >Existence: 9 Extension: 1</option>		
	</select>
	<select id="ncbi_gapcosts_BLOSUM45" class="ncbi_gapcosts" style="display: none">
		<option value = "13 3"   >Existence: 13 Extension: 3</option>	
		<option value = "12 3"   >Existence: 12 Extension: 3</option>	
		<option value = "11 3"   >Existence: 11 Extension: 3</option>	
		<option value = "10 3"   >Existence: 10 Extension: 3</option>	
		<option value = "15 2"  selected >Existence: 15 Extension: 2</option>	
		<option value = "14 2"   >Existence: 14 Extension: 2</option>	
		<option value = "13 2"   >Existence: 13 Extension: 2</option>	
		<option value = "12 2"   >Existence: 12 Extension: 2</option>	
		<option value = "19 1"   >Existence: 19 Extension: 1</option>	
		<option value = "18 1"   >Existence: 18 Extension: 1</option>	
		<option value = "17 1"   >Existence: 17 Extension: 1</option>	
		<option value = "16 1"   >Existence: 16 Extension: 1</option>		
	</select>
      </TR>
      </TABLE>
      <DIV id=ncbi_pro_or_nu_param></DIV>
     </TD>
   </TMPL_IF>
    <TMPL_IF NAME="REST">
     </TR>
    </TABLE>
 </DIV>
  </div>
 </TR>

 <TR>
   <TH colspan="3">
   <DIV class="mainDiv">
   <DIV id = "dr" class="topItem">Query Sequence(s):</DIV>
   <DIV class="dropMenu" id="query_seqs">
   <TABLE> 
   <THEAD align="left">
   <TH>Sequences (fasta format):</TH>
   <TH>Select a BLAST to run:</TH>
   </THEAD>
   <TBODY>
    <TR align=left valign=top>
    <TD>
      <textarea class="backbox" type="textarea" onFocus="clear_if_no_seq()" name="seq_box" id ="seq_box" wrap=off cols=80 rows=15><TMPL_VAR NAME="SEQUENCE"></textarea>
     </TD>
      <TD valign="top">
       <div id="coge_blast_type">
       <TABLE>
       <TR>
        <TD valign="top">
         <label><input id=coge_radio type=radio name=cogeblast value="coge_blast_type_n" checked onClick="display_correct_radio($('#coge_radio')[0].checked,'coge');get_seq('coge_radio');blast_param_on_select('coge_radio','coge');">Nucleotide Sequence</label>
         <br>
          <div id=coge_select_n>
           <select name=coge_blasttype id=coge_blast_type_n onChange="blast_param_on_select('coge_radio','coge')">
            <optgroup label="--- Select BLAST Type ---">
            <option value = "blastn"> blastn
            <option value = "tblastx"> tblastx
            <option value = "blastz"> blastz
           </optgroup>
           </select>
           <br>
          </div>
         <br>
         <label><input id=coge_radio type=radio name=cogeblast value="coge_blast_type_p" onClick="display_correct_radio($('#coge_radio')[0].checked,'coge');get_seq('coge_radio');blast_param_on_select('coge_radio','coge')">Protein Sequence</label>
         <br>
          <div id=coge_select_p style="display:none;">
           <select name=coge_blasttype id=coge_blast_type_p onChange="blast_param_on_select('coge_radio','coge')">
            <optgroup label="--- Select BLAST Type ---">
            <option value = "tblastn"> tblastn
            </optgroup>
           </select>
           <br>
          </div>
         <br>
         </TR>
         </TABLE>
<b>Color Blast Hits According to:<br></b>
    &nbsp&nbsp<input type="radio" name = "color_by" id = "color_by" value="0" checked> None<br>
    &nbsp&nbsp<input type="radio" name = "color_by" id = "color_by" value="query"> Query Sequence<br>
    &nbsp&nbsp<input type="radio" name = "color_by" id = "color_by" value="quality"> Log Quality<bR>
    &nbsp&nbsp<input type="radio" name = "color_by" id = "color_by" value="identity"> Percent Identity<bR>

         </div>
      <div id="ncbi_blast_type" style="display:none;">
       <TABLE>
       <TR>
        <TD valign="top">
         <label><input id=ncbi_radio type=radio name=ncbiblast value="ncbi_blast_type_n" checked="" onClick="display_correct_radio($('#ncbi_radio')[0].checked,'ncbi');get_seq('ncbi_radio');blast_param_on_select('ncbi_radio','ncbi');">Nucleotide Sequence</label>
         <br>
          <div id=ncbi_select_n>
           <select name=ncbi_blasttype id=ncbi_blast_type_n onChange="blast_param_on_select('ncbi_radio','ncbi')">
            <optgroup label="--- Select BLAST Type ---">
            <option value = "blastn"> blastn
            <option value = "blastx"> blastx
            <option value = "tblastx"> tblastx
           </optgroup>
           </select>
           <br>
          </div>
         <br>
         <label><input id=ncbi_radio type=radio name=ncbiblast value="ncbi_blast_type_p" onClick="display_correct_radio($('#ncbi_radio')[0].checked,'ncbi');get_seq('ncbi_radio');blast_param_on_select('ncbi_radio','ncbi')">Protein Sequence</label>
         <br>
          <div id=ncbi_select_p style="display:none;">
           <select name=ncbi_blasttype id=ncbi_blast_type_p onChange="blast_param_on_select('ncbi_radio','ncbi')">
            <optgroup label="--- Select BLAST Type ---">
            <option value = "blastp"> blastp
            <option value = "tblastn"> tblastn
            </optgroup>
           </select>
           <br>
          </div>
         <br>
         </TR>
         </TABLE>
         </div>
      </TD>
   </TR>
  </table>
   </DIV>
   </DIV>
   </DIV>
 </TR>


 </TABLE>
</TMPL_IF>


    <TMPL_IF NAME="BLAST_NU">
     <TH align=left valign="top"><u> Nucleotide Specific Parameters</u><br>
      <TABLE>
       <TR>
	<TD valign="top">
	 Match/Mismatch Scores:
         </TD>
         <TD>
	    <select id=match_score name=match_score onchange="update_gapcost()">
	     <option selected="selected" value="1,-2">1,-2</option>
	     <option value="1,-3">1,-3</option>
	     <option value="1,-4">1,-4</option>
	     <option value="2,-3">2,-3</option>
     	     <option value="4,-5">4,-5</option>
	     <option value="1,-1">1,-1</option>
	 </TD>
       </TR>
      </TABLE>
    </TMPL_IF>
    <TMPL_IF NAME="BLAST_PRO">
     <TH align=left valign="top"><u>Protein Specific Parameters</u><br>
      <TABLE>
       <TR>
        <TD valign="top">
	 Matrix
        </TD>
        <TD>
	     <select name=matrix id=matrix onChange="update_gapcost(1)">
              <option value = "PAM30"> PAM30
	      <option value = "PAM70"> PAM70
              <option value = "BLOSUM80"> BLOSUM80
              <option value = "BLOSUM62" selected> BLOSUM62
              <option value = "BLOSUM45"> BLOSUM45
             </select>
	     <div onclick="matrix_view();" class="link small">View Matrix</div>
       </TR>
       <TMPL_IF NAME=BLAST_PRO_COMP>
       <TR>
        <TD>
	 Compositional adjustments
	</TD>
	<TD>
	     <select name=comp_adj id=comp_adj>
              <option value = "0"> No adjustment
	      <option value = "1" selected> Composition-based statistics
              <option value = "2"> Conditional compositional score matrix adjustment
              <option value = "3"> Universal compositional score matrix adjustment
             </select>
       </TR>
       </TMPL_IF>
      </TABLE>
    </TMPL_IF>
    
     <TMPL_IF NAME="NCBI_BLAST_NU">
     <TH align=left valign="top"><u> Nucleotide Specific Parameters</u><br>
      <TABLE>
       <TR>
	<TD valign="top">
	 Match/Mismatch Scores:
         </TD>
         <TD>
	    <select id=ncbi_match_score name=ncbi_match_score onchange="update_gapcost_ncbi()">
	     <option selected="selected" value="1,-2">1,-2</option>
	     <option value="1,-3">1,-3</option>
	     <option value="1,-4">1,-4</option>
	     <option value="2,-3">2,-3</option>
     	     <option value="4,-5">4,-5</option>
	     <option value="1,-1">1,-1</option>
	 </TD>
       </TR>
      </TABLE>
    </TMPL_IF>
    <TMPL_IF NAME="NCBI_BLAST_PRO">
     <TH align=left valign="top"><u>Protein Specific Parameters</u><br>
      <TABLE>
       <TR>
        <TD valign="top">
	 Matrix
        </TD>
        <TD>
	     <select name=ncbi_matrix id=ncbi_matrix onChange="update_gapcost_ncbi(1)">
              <option value = "PAM30"> PAM30
	      <option value = "PAM70"> PAM70
              <option value = "BLOSUM80"> BLOSUM80
              <option value = "BLOSUM62" selected> BLOSUM62
              <option value = "BLOSUM45"> BLOSUM45
             </select>
       </TR>
       <TMPL_IF NAME=NCBI_BLAST_PRO_COMP>
       <TR>
        <TD>
	 Compositional adjustments
	</TD>
	<TD>
	     <select name=ncbi_comp_adj id=ncbi_comp_adj>
              <option value = "0"> No adjustment
	      <option value = "1" selected> Composition-based statistics
              <option value = "2"> Conditional compositional score matrix adjustment
              <option value = "3"> Universal compositional score matrix adjustment
             </select>
       </TR>
       </TMPL_IF>
      </TABLE>
    </TMPL_IF>
    
    <TMPL_IF NAME=NU_DB>
    <select name=ncbi_db id=ncbi_db>
	  <optgroup label="Genomic plus Transcript">
           <option value = "Test/gpipe/9606/allcontig_and_rna"> Human genomic plus transcript
           <option value = "Test/gpipe/10090/allcontig_and_rna"> Mouse genomic plus transcript
	  </optgroup>
	  <optgroup label="Other Databases">
           <option value = "nr" selected> Nucleotide collection (nr/nt)
           <option value = "refseq_rna"> Reference mRNA sequences (refseq_rna)
           <option value = "refseq_genomic"> Reference genomic sequences (refseq_genomic)
           <option value = "est"> Expressed sequence tags (est)
           <option value = "est_others"> Non-human, non-mouse ESTs (est_others)
           <option value = "gss"> Genomic survey sequences (gss)
           <option value = "htgs"> High throughput genomic sequences (HTGS)
           <option value = "pat"> Patent sequences (pat)
           <option value = "pdb"> Protein Data Bank (pdb)
           <option value = "alu"> Human ALU repeat elements (alu_repeat)
           <option value = "dbsts"> Sequence tagged sites (dbsts)
           <option value = "wgs"> Whole-genome shotgun reads (wgs)
           <option value = "env_nt"> Environmental samples (env_nt)
	  </optgroup>
          </select>
    </TMPL_IF>
   
    <TMPL_IF NAME=PRO_DB>
    <select name=blast_db id=blast_db>
	<option value="nr" selected>Non-redundant protein sequences (nr)</option>
	<option value="refseq_protein">Reference proteins (refseq_protein)</option>	
	<option value="swissprot">Swissprot protein sequences(swissprot)</option>
	<option value="pat">Patented protein sequences(pat)</option>
	<option value="pdb">Protein Data Bank proteins(pdb)</option>
	<option value="env_nr">Environmental samples(env_nr)</option>
    </TMPL_IF>

    <TMPL_IF NAME=T_DB>
    <select name=blast_db id=blast_db>
        <option value="nr" selected>Nucleotide collection (nr/nt)</option>
	<option value="refseq_rna">Reference mRNA sequences (refseq_rna)</option>
	<option value="refseq_genomic">Reference genomic sequences (refseq_genomic)</option>
	<option value="est">Expressed sequence tags (est)</option>
	<option value="est_others">Non-human, non-mouse ESTs (est_others)</option>
	<option value="gss">Genomic survey sequences (gss)</option>
	<option value="htgs">High throughput genomic sequences (HTGS)</option>
	
	<option value="pat">Patent sequences(pat)</option>
	<option value="pdb">Protein Data Bank (pdb)</option>
	<option value="alu">Human ALU repeat elements (alu_repeats)</option>
	<option value="dbsts">Sequence tagged sites (dbsts)</option>
	<option value="wgs">Whole-genome shotgun reads (wgs)</option>
	<option value="env_nt">Environmental samples (env_nt)</option>
   </TMPL_IF>
   
   
<TMPL_IF NAME="RESULT_TABLE">
<span class=species>HSP Table:</span>
   <div id=table_size style="max-height: 340px;">
   <div id="null"><TMPL_VAR NAME=NULLIFY></div>
   <TMPL_IF NAME="HSP_TABLE">
   <TABLE id="hsp_result_table" cellspacing="2" class="resultborder" style="overflow: auto;">
     <!--<caption>HSPs w/o overlapping features:</caption>-->
     <THEAD>
      <TR nowrap align=middle>
        <TH nowrap class=small>click to sort &rarr;</TH>
        <TH nowrap class=header>Query Seq</TH>
        <TH nowrap class=header>Org</TH>
        <TH nowrap class=header>Chr</TH>
 	<TH nowrap class="header" >Position</TH>	
        <TH nowrap class=header>HSP#</TH>
        <TH nowrap class=header>Length</TH>
        <TH class=header>Coverage</TH>
        <TH nowrap class=header>E-value</TH>
        <TH nowrap class=header>Perc ID</TH>
        <TH nowrap class=header>Score</TH>
        <TH nowrap class=header>Quality</TH>
        <TH class=header>Closest Genomic Feature</TH>
        <TH nowrap class=header>Distance(bp)</TH>
       </TR>
     </THEAD>
     <TBODY id=hsp_result_table_body style="overflow: auto;">
     <TMPL_LOOP NAME=HSPS>
       <tr class="feat" id="<TMPL_VAR NAME=ID>" >
         <td align=right id="checkbox<TMPL_VAR NAME=CHECKBOX>"><input type=checkbox id="<TMPL_VAR NAME=CHECKBOX>" value="<TMPL_VAR NAME=CHECKBOX>"></td>
         <td><TMPL_VAR NAME=QUERY_SEQ></td>
         <td style="white-space:nowrap;"><TMPL_VAR NAME=HSP_ORG></td>
         <td><TMPL_VAR NAME=HSP_CHR></td>
         <td><TMPL_VAR NAME=HSP_POS></td>
         <td><TMPL_VAR NAME=HSP></td>
         <td><TMPL_VAR NAME=HSP_LENGTH></td>
         <td><TMPL_VAR NAME=COVERAGE></td>
         <td><TMPL_VAR NAME=HSP_EVAL></td>
         <td><TMPL_VAR NAME=HSP_PID></td>
         <td><TMPL_VAR NAME=HSP_SCORE></td>
         <td><TMPL_VAR NAME=HSP_QUALITY></td>
         <td style="white-space:nowrap;"><div id ="feat<TMPL_VAR NAME=ID>"><TMPL_VAR NAME=HSP_LINK></div>
         <td><div id="dist<TMPL_VAR NAME=ID>">-</div></td>
       </tr>
      </TMPL_LOOP>
     </tbody>
    </table>
    <br>
   </TMPL_IF>
   </div>      

</TMPL_IF>
   
   <TMPL_IF NAME=CHROMOSOMES_IF>
       <TMPL_LOOP NAME=CHROMOSOME_LOOP>
         <TMPL_VAR NAME=DB_NAME>
         <TMPL_VAR NAME=CHR_IMAGE>
         <TMPL_IF NAME=HIT>
         <a href='#imagewindow' onClick="enlarge_picture_window(<TMPL_VAR NAME=IMAGE_ID>);" class=small>Enlarge Picture</a>
         </TMPL_IF>
        <br><br>
       </TMPL_LOOP>
   </TMPL_IF>
   
   <TMPL_IF NAME=CHROMOSOMES_LARGE_IF>
        <TMPL_LOOP NAME=CHROMOSOME_LOOP_LARGE>
          <div id=large_db<TMPL_VAR NAME=IMAGE_ID_LARGE> style="display:none"><TMPL_VAR NAME=DB_NAME_LARGE></div>
          <div id=large_pic<TMPL_VAR NAME=IMAGE_ID_LARGE> style="display:none"><TMPL_VAR NAME=CHR_IMAGE_LARGE></div>
        </TMPL_LOOP>
   </TMPL_IF>
   
   <TMPL_IF NAME=HSP_IF>
     <span class=species>HSP Number <TMPL_VAR NAME=HSP_NUM> Information:</span><br>
      <TABLE id="hsp_table" class="resultborder" style="width: 400px; overflow: auto;" cellspacing="2">
      <tr>
      <td valign="top">
      <table >
   	  <THEAD>
         <TR>
          <TH> </TH>
          <TH class="header">Query</TH>
          <TH class="header">Subject</TH>
         </TR>
         </THEAD>
         <TBODY style="font-size: 10pt;">
         <TMPL_LOOP NAME=HSP_QS>
         <!--onmouseover="$('#table_row<TMPL_VAR NAME=FID>').addClass('highlight_tablerows');" onmouseout="$('#table_row<TMPL_VAR NAME=FID>').removeClass('highlight_tablerows');"-->
          <tr>
          <TD >Perc ID</TD>
          <TD><TMPL_VAR NAME=HSP_PID_QUERY></TD>
          <TD><TMPL_VAR NAME=HSP_PID_SUB></TD>
          </tr>
          <tr>
          <TD >Perc Sim</TD>
          <TD><TMPL_VAR NAME=HSP_PSIM_QUERY></TD>
          <TD><TMPL_VAR NAME=HSP_PSIM_SUB></TD>
          </tr>
          <TR >
          <TD >Match</TD>
          <TD><TMPL_VAR NAME=HSP_MATCH_QUERY></TD>
          <TD><TMPL_VAR NAME=HSP_MATCH_SUB></TD>
          </tr>
          <tr>
          <TD >Mismatch</TD>
          <TD><TMPL_VAR NAME=HSP_MISMATCH_QUERY></TD>
          <TD><TMPL_VAR NAME=HSP_MISMATCH_SUB></TD>
          </tr>
          <tr>
          <TD >Gap</TD>
          <TD><TMPL_VAR NAME=HSP_GAP_QUERY></TD>
          <TD><TMPL_VAR NAME=HSP_GAP_SUB></TD>
         </TR>
         <tr>
          <TD >Position</TD>
          <TD><TMPL_VAR NAME=HSP_POSITION_QUERY></TD>
          <TD><TMPL_VAR NAME=HSP_POSITION_SUB></TD>
          </TR>
          <tr>
        </TBODY>
        </TMPL_LOOP>
        </table>
        </TD>
        <TD valign="top">
        <table>
         <THEAD>
         <TR>
          <TH> </TH>
          <TH class="header">HSP</TH>
         </TR>
         </THEAD>
          <TMPL_LOOP NAME=HSP_HSP>
         <TBODY style="font-size: 10pt;">
           <TR>
          <TD>E-Value</TD>
          <TD><TMPL_VAR NAME=HSP_EVAL></TD>
          </tr>
          <tr>
          <TD >Score</TD>
          <TD><TMPL_VAR NAME=HSP_SCORE></TD>
          </tr>
          <tr>
          <TD >Strand</TD>
          <TD><TMPL_VAR NAME=HSP_STRAND></TD>
          </tr>
          <TD >Length</TD>
          <TD><TMPL_VAR NAME=HSP_LENGTH></TD>
          </TR>
          <tr>
           <TD >Chromosome</TD>
           <TD><TMPL_VAR NAME=HSP_CHR></TD>
          </TR>
        </TBODY>
        </TMPL_LOOP>
        </table>
        </TR>
        </TABLE>
        <br>
        <table width=100%>
          <tr>
            <td><TMPL_VAR NAME=QUERY_SEQ></td>
            <td><TMPL_VAR NAME=SUB_SEQ></TD>
            <td><TMPL_VAR NAME=ALIGNMENT></td>
          </tr>
         </table>
         <TMPL VAR NAME="HSP_EXCEL_LINK">
  </TMPL_IF>
   
<TMPL_IF NAME=BLAST_RESULTS>
<TABLE width=100%>
  <TR>
    <TD>
   <TH colspan="3">
   <DIV class="mainDiv bresults">
   <DIV id = "br" class="topItem bresults" style="display: none" onMouseOver="$('#br').removeClass('topItem').addClass('topItemSelected');" onMouseOut="$('#br').removeClass('topItemSelected').addClass('topItem');" onClick='animate_section("#results", "slideToggle")'>Blast Results:</DIV>
   <DIV class="dropMenu bresults" id="results">
   <DIV class="subMenu" style="display:inline;">
    <TABLE width=100%>
    <thead>
     <th><input type=button value="Hide Genome Data" id=left_column_button_hide onClick="$('#left_column').hide(0);$('#left_column_button_hide').hide(0);$('#left_column_button_show').show(0);"><input type=button value="Show Genome Data" id=left_column_button_show style="display:none" onClick="$('#left_column').show(0);$('#left_column_button_show').hide(0);$('#left_column_button_hide').show(0);"></th>
    <th><input type=button value="Hide HSP Data" id=middle_column_button_hide style="display:none" onClick="$('#result_visual').hide(0);$('#middle_column_button_hide').hide(0);$('#middle_column_button_show').show(0);"><input type=button value="Show HSP Data" id=middle_column_button_show style="display:none" onClick="$('#result_visual').show(0);$('#middle_column_button_show').hide(0);$('#middle_column_button_hide').show(0);"></th>
    <th><input type=button value="Hide Table/Feature Data" id=right_column_button_hide onClick="$('#result_features').hide(0);$('#right_column_button_hide').hide(0);$('#right_column_button_show').show(0);"><input type=button value="Show Table/Feature Data" id=right_column_button_show style="display:none" onClick="$('#result_features').show(0);$('#right_column_button_show').hide(0);$('#right_column_button_hide').show(0);"></th>
    </thead>
 	<tbody>
    <TR>
     <TD align=left  valign="top" >
     <div id=left_column>
     <span class=species>Genomic HSP Visualization:</span>
     <DIV id=chromosomes class="resultborder" style="width: 405px;overflow: auto;max-height: 700px;">

     <TMPL_VAR NAME=CHROMOSOMES>
     <TMPL_VAR NAME=CHR_LARGE>
      </DIV>
     <TMPL_VAR NAME="DATA_FILES">

     </div>
      </TD>
      <TD valign="top">
       <DIV id=result_visual valign="top" style="display: none;width:450">
         <span class=species>HSP Graphics:</span>
        <DIV id=query_image class="hsp_image"></DIV>
        <DIV id=subject_image class="hsp_image"></DIV>
        <DIV id=image_info><TMPL_VAR NAME=HSP></DIV>
      </DIV>
      </TD>
      <TD valign="top" align=left >
       	 <DIV id=result_features align=left valign="top">
          <form id=feature_list style="position:static">
          <TMPL_VAR NAME="HSP_RESULTS">
          </form>
          <table>
            <tr valign=top>
				<td align=left class=species>HSP count: <TMPL_VAR NAME=HSP_COUNT>

				<td align=right>
       			<input type=button id="click_links" value="Show all Features" onClick="click_all_feat_links();$('#click_links').hide(0)"> <input type=button value="Select All" onClick="$('#feature_list').checkCheckboxes()">  <input type=button value="Select None" onClick="$('#feature_list').unCheckCheckboxes()"> 
        		<br>
         		Do Following to Checked Features: 
          		<select name=overlap_action id=overlap_action>
           		 <option value = "gevo">Send to GEvo</option>
           		 <option value = "fasta">Create FASTA File</option>
          		  <option value = "xls">Export to Excel</option>
           		 <option value = "tab">Tab Deliminated</option>
           		 <option value = "list">Get Feature List</option>
<!--            <option value = "user">Add to MFF</option> -->
          	    </selected>  
          		<input type=button value="Go" onClick="overlap_checkboxes()">
       <tr><td colspan=2 align=left><div id=overlap_box style="display: none" valign="top" class="resultborder"></div>
 		</table>
 </div>
     </TD>
    <TR>
    <td valign=top>
    <td>

    

   </TABLE>
   </TD>
</DIV>
</DIV>
</DIV>
  </TR>
</TABLE>

   </TMPL_IF>
   
<TMPL_IF NAME="RESULTS_DIV">
<table align=center><tr><td>
<DIV id=log_text class='dna' style="display:none"></DIV>
<DIV id=blast_results ></DIV>
</table>
</TMPL_IF>